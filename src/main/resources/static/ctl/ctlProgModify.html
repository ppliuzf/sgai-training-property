<html><head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="renderer" content="webkit"><meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10">
<meta http-equiv="Expires" content="0"><meta http-equiv="Cache-Control" content="no-cache"><meta http-equiv="Cache-Control" content="no-store">
<script src="../static/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
<link href="../static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css" type="text/css" rel="stylesheet">
<script src="../static/bootstrap/2.3.1/js/bootstrap.min.js" type="text/javascript"></script>
<link href="../static/bootstrap/2.3.1/awesome/font-awesome.min.css" type="text/css" rel="stylesheet">
<!--[if lte IE 7]><link href="../static/bootstrap/2.3.1/awesome/font-awesome-ie7.min.css" type="text/css" rel="stylesheet" /><![endif]-->
<script src="../static/bootstrap/bsie/js/bootstrap-ie.min.js" type="text/javascript"></script><![endif]-->
<link href="../static/jquery-select2/4.0/select2.min.css" rel="stylesheet">
<script src="../static/jquery-select2/4.0/select2.min.js" type="text/javascript"></script>
<script src="../static/jquery-select2/4.0/zh-CN.js" type="text/javascript"></script>
<link href="../static/jquery-validation/1.11.0/jquery.validate.min.css" type="text/css" rel="stylesheet">
<script src="../static/jquery-validation/1.11.0/jquery.validate.min.js" type="text/javascript"></script>
<link href="../static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css" rel="stylesheet">
<script src="../static/jquery-jbox/2.3/jquery.jBox-2.3.min.js" type="text/javascript"></script>
<script src="../static/My97DatePicker/WdatePicker.js" type="text/javascript"></script><link href="../static/My97DatePicker/skin/WdatePicker.css" rel="stylesheet" type="text/css">
<script src="../static/common/mustache.min.js" type="text/javascript"></script>
<link href="../static/common/smart.min.css" type="text/css" rel="stylesheet">
<script src="../static/common/smart.min.js" type="text/javascript"></script>
<script src="../static/jquery-form/3.51.0/jquery.form.js" type="text/javascript"></script>
<script src="../config/smart-common.js"
	type="text/javascript"></script>
<script type="text/javascript">var ctx = '/admin', ctxStatic='/static';</script>
    <title>功能管理</title>
    <meta name="decorator" content="default">
    <link href="../static/media/css/my-style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<form id="updateForm" class="form-horizontal" method="post" novalidate="novalidate">
    <input id="id" name="id" type="hidden" value="">
<script type="text/javascript">top.$.jBox.closeTip();</script>
    <div class="control-group">
        <label class="control-label">功能代码:</label>
        <div class="controls">
            <input id="progCode" name="progCode" class="required" type="text" value="" maxlength="100">
            <span class="help-inline"><font color="red">*</font> </span>
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">功能名称:</label>
        <div class="controls">
            <input id="progName" name="progName" class="required" type="text" value="" maxlength="50">
            <span class="help-inline"><font color="red">*</font> </span>
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">功能路径:</label>
        <div class="controls">
            <input id="progPath" name="progPath" class="required" type="text" value="" maxlength="50">
            <span class="help-inline"><font color="red">*</font> </span>
        </div>
    </div>
	<div class="control-group">
        <label class="control-label">功能级别:</label>
        <div class="controls aa">
            <select id="progLevel" autocomplete="off" name="progLevel" class="input-xlarge select2-offscreen" tabindex="-1">
                <!-- <option value="" >请选择</option>
                <option  value="S">系统级</option>
                <option value="C">企业级</option>
                <option  value="B">按钮级</option> -->
            </select>
            <span class="help-inline"><font color="red">*</font> </span>
            <span id="progLevelSpan"></span>
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">功能类型:</label>
        <div class="controls">
            <select id="progType" autocomplete="off" name="progType" class="input-xlarge select2-offscreen" tabindex="-1">
                <!-- <option value="" selected="selected">请选择</option>
                <option value="A">所有用户</option>
                <option value="I">只授权给内部用户</option>
                <option value="O">只授权给外部用户</option> -->
            </select>
            <span class="help-inline"><font color="red">*</font> </span>
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">模块名称:</label>
        <div class="controls">
            <input type="hidden" id="sbsName" name="sbsName" value="">
             <select id="sbsCode" name="sbsCode" class="input-xlarge select2-offscreen" tabindex="-1">
                <!-- <option value="" selected="selected">请选择</option>
                <option value="A">所有用户</option>
                <option value="I">只授权给内部用户</option>
                <option value="O">只授权给外部用户</option> -->
            </select>
            <span class="help-inline"><font color="red">*</font> </span>
        	<!-- <input type="hidden" id="sbsCode" name="sbsCode" value="">
            <input id="sbsName" name="sbsName" class="required" type="text" value="" maxlength="50" onclick="getModuList();">
            <span class="help-inline"><font color="red">*</font> </span> -->
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">日志级别:</label>
        <div class="controls">
            <input id="logLevel" name="logLevel" class="required" type="text" value="" maxlength="50">
            <span class="help-inline"><font color="red">*</font> </span>
        </div>
    </div>
   <div class="control-group">
        <label class="control-label">系统初始化检查标识:</label>
        <div class="controls">
            <select id="initCheckFlag" name="initCheckFlag" class="input-xlarge select2-offscreen" tabindex="-1">
                <!-- <option value="Y">是</option>
                <option value="N">否</option> -->
            </select>
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">每页显示行数:</label>
        <div class="controls">
            <input id="linesPerpage" name="linesPerpage" type="text" value="" maxlength="50">
        </div>
    </div>
    <div class="control-group">
        <label class="control-label">备注:</label>
        <div class="controls">
            <textarea id="remark" name="remark" maxlength="200" class="input-xlarge" rows="3"></textarea>
        </div>
    </div>
    <div class="form-actions">
        <input id="btnCancel" class="btn btn_cancel" type="button" value="关 闭" onclick="closePopUp()">
    	<input id="btnUpdate" class="btn btn-primary btn_true" type="button" value="保 存" onclick="updateProg();">
    </div>
</form>
<!-- Modal -->
<!-- <div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3 id="myModalLabel">系统模块</h3>
  </div>
  <div class="modal-body">
     <table id="privilegeTable" class="table table-bordered">
		      <thead>
		        <tr>
		          <th></th>
		          <th>模块代码</th>
		          <th>模块名称</th>
		        </tr>
		      </thead>
		    </table>
	    	<div class="pagination">
				<div id="page_div"></div>
			</div>
	    
  </div>
  <div class="modal-footer">
  	<button id="btnSure" class="btn btn-primary" onclick="addModuCode();">确定</button>
    <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
  </div>
</div> -->
<script type="text/javascript">
// function page(n, s) {
//     getModuList(n, s);
//     return false;
// }
// function getModuList(n, s){
//     $('#myModal').modal('show');
//     //删除旧tbody
//     var contentTableSub = document.getElementById("privilegeTable");
//     var oldTbody = document.getElementById("privilegeTbody");
//     if (oldTbody != null) {
//         contentTableSub.removeChild(oldTbody);
//     }
//     //添加新tbody
//     $.ajax({
//         headers    : {
//             "token" : localStorage.getItem("token"),
//         },
//         url : APIHost + '/admin/ctlModu/getListModu',
//         type : 'POST',
//         async : false, //或false,是否异步
//         data : {
//             pageNo : n,
//             pageSize : s
//         },
//         timeout : 30000,
//         dataType : 'json',
//         success : function(data) {
//             document.getElementById("page_div").innerHTML=data.html;
//             var newTbody = document.createElement("tbody");
//             newTbody.setAttribute("id", "privilegeTbody");
//             var list = data.list;
            
//             for (var i = 0; i < list.length; i++) {
//                 var tr = document.createElement("tr");
//                 var td0 = document.createElement("td");
//                 td0.innerHTML = "<input type='radio' name ='optionsRadios' data-code='"+list[i].sbsCode+"' value='"+list[i].sbsName+"'/>"
//                 tr.appendChild(td0);

//                 //模块代码
//                 var td1 = document.createElement("td");
//                 td1.innerHTML = list[i].sbsCode;
//                 tr.appendChild(td1);
                
//                 //模块名称
//                 var td2 = document.createElement("td");
//                 td2.innerHTML = list[i].sbsName;
//                 tr.appendChild(td2);
                
//                 newTbody.appendChild(tr);
//             }
//             contentTableSub.appendChild(newTbody);
//         },
//         error : function() {
//             console.log('错误')
//         }
//     })
// }


// $("#sbsName").focus(function(){
//     $(this).css("display","none");
//     $("#sbsCode").css("display","block");
//     $("#s2id_sbsCode").css("display","inline-block");
// })

//选择模块数据
function addModuCode(){
    var length=$("input[name ='optionsRadios']:checked").length;
    if(length==0){
    	$.jBox.alert("请选择模块！");
    }else{
        var sbsName = $("input[name ='optionsRadios']:checked").val();
        var sbsCode = $("input[name ='optionsRadios']:checked").attr("data-code")
        $("#sbsName").val(sbsName);
        $("#sbsCode").val(sbsCode);
        $('#myModal').modal('hide');
    }   
}
$(function(){
    loadDictByType("progLevel","prog_level");
    loadDictByType("progType","prog_type");
    loadDictByType("initCheckFlag","yesno");
})
</script>
<script type="text/javascript">

        $(function(){
            setTimeout(function(){
                //获取要修改的功能信息
                //var paramId=getCookie("paramId");
                var paramId=GetQueryString("paramId");
                $.ajax({
                    headers    : {
                        "token" : localStorage.getItem("token"),
                    },
                    url : APIHost + '/admin/prog/ctlProg/getProg',
                    type : 'POST',
                    data : {
                        id : paramId
                    },
                    dataType : 'json',
                    success : function(data) {
                        $("#id").val(paramId);
                        $("#progCode").val(data.ctlProg.progCode);
                        $("#progName").val(data.ctlProg.progName);
                        $("#progPath").val(data.ctlProg.progPath);
                        var select = document.getElementById("progLevel");
                        for (var i = 0; i < select.options.length; i++){  
                            if (select.options[i].value == data.ctlProg.progLevel){
                                select.options[i].selected = true;
                                $("#progLevel").parent().find("span.select2-chosen").html(select.options[i].text);
                                break;  
                            }  
                        }
                        var select1 = document.getElementById("progType");
                        for (var i = 0; i < select1.options.length; i++){  
                            if (select1.options[i].value == data.ctlProg.progType){  
                                select1.options[i].selected = true;
                                $("#progType").parent().find("span.select2-chosen").html(select1.options[i].text);
                                break;  
                            }  
                        }
                        var select2 = document.getElementById("initCheckFlag");
                        for (var i = 0; i < select2.options.length; i++){  
                            if (select2.options[i].value == data.ctlProg.initCheckFlag){  
                                select2.options[i].selected = true;
                                $("#initCheckFlag").parent().find("span.select2-chosen").html(select2.options[i].text);
                                break;  
                            }  
                        }
                        var str = '<option value="'+data.ctlProg.sbsCode+'">'+data.ctlProg.sbsName+'</option>';
                        $("#sbsCode").append(str);
                        // $("#sbsCode").val(data.ctlProg.sbsCode);
                        // $("#sbsName").val(data.ctlProg.sbsName);
                        //$("#progType").val(data.ctlProg.progType);
                        //$("#initCheckFlag").val(data.ctlProg.initCheckFlag);
                        $("#logLevel").val(data.ctlProg.logLevel);
                        $("#linesPerpage").val(data.ctlProg.linesPerpage);
                        $("#remark").val(data.ctlProg.remark);
                    }
                }) 
            },200);
        })
                  
        
        //提交修改信息
        function updateProg(){
            var progCode = $("#progCode").val();
            if(progCode==""){
            	$.jBox.alert("请填写功能代码！");
            }else{
                var ajax_option={
                        headers    : {
                             "token" : localStorage.getItem("token"),
                         },
                        url:APIHost + '/admin/prog/ctlProg/update',//默认是form action
                        success:function(data){
                            if(data.msg=="success"){
                            	$.jBox.alert("修改成功！");
                                setTimeout(function(){
                                    //location.href = APIHost + "/ctl/ctlProgList.html"
                                    //关闭弹窗
                                    closePopUp();
                                    parent.pageload();
                                },500)
                                
                            }else{
                            	$.jBox.alert("修改失败！");
                            }
                        }
                    }
                $("#updateForm").ajaxSubmit(ajax_option);
            }
        }
       
        //获取跳转地址的参数
        function GetQueryString(name){
             var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
             var r = window.location.search.substr(1).match(reg);
             if(r!=null)return  unescape(r[2]); return null;
        }
        
        // 关闭弹框
        function closePopUp(){
            $('#myModalEdit .close', window.parent.document).click();
        }
      
      //获取指定cookie值
        function getCookie(name){ 
            var strCookie=document.cookie; 
            var arrCookie=strCookie.split("; "); 
            for(var i=0;i<arrCookie.length;i++){ 
            var arr=arrCookie[i].split("="); 
            if(arr[0]==name)
                return arr[1]; 
            } 
            return ""; 
            } 

    $.ajax({
        headers    : {
            "token" : localStorage.getItem("token"),
        },
        url : APIHost + '/admin/ctlModu/getListModu',
        type : 'POST',
        async : false, //或false,是否异步
        data : {
            pageNo : 1,
            pageSize : 100000
        },
        timeout : 30000,
        dataType : 'json',
        success : function(data) {
            var list = data.list;
            var str = '<option>请选择</option>';
            for (var i = 0; i < list.length; i++) {
                str += '<option data_name="'+list[i].sbsName+'" value="'+list[i].sbsCode+'">'+list[i].sbsName+'</option>'; 
            }
            $("#sbsCode").append(str);
        },
        error : function() {
			$.jBox.alert("服务器代码发生异常,请联系管理员!",'提示');

        }
    })
    var select = document.getElementById("sbsCode");
    select.onchange = function(){
        var selectedName = this.options[this.options.selectedIndex].innerHTML;
        $("#sbsName").val(selectedName);

    }
    </script>
</body>
</html>