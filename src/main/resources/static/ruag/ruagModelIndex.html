<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-store">
    <link href="../static/jquery-validation/1.11.0/jquery.validate.min.css" type="text/css" rel="stylesheet">
    <link href="../static/jquery-select2/4.0/select2.min.css" rel="stylesheet">
    <link href="../static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css" rel="stylesheet">
    <link href="../static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css" type="text/css" rel="stylesheet">
    <!-- 日历css -->
    <link rel="stylesheet" type="text/css" media="all" href="../static/bootstrap/dist/css/daterangepicker.css">
    <link href="../static/common/smart.min.css" rel="stylesheet" type="text/css"/>
    <link href="../static/media/css/my-style.css" rel="stylesheet" type="text/css"/>
    <script src="../static/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
    <script src="../static/jquery-validation/1.11.0/jquery.validate.min.js" type="text/javascript"></script>
    <script src="../static/jquery-select2/4.0/select2.min.js" type="text/javascript"></script>
    <script src="../static/jquery-select2/4.0/zh-CN.js" type="text/javascript"></script>
    <script src="../static/jquery-jbox/2.3/jquery.jBox-2.3.min.js" type="text/javascript"></script>
    <script src="../static/jquery-form/3.51.0/jquery.form.js" type="text/javascript"></script>
    <script src="../static/media/js/main.js" type="text/javascript"></script>
    <script src="../static/common/smart.min.js" type="text/javascript"></script>
    <script src="../config/smart-common.js" type="text/javascript"></script>
    <!--分页  -->
    <script src="../static/paginator/bootstrap-paginator.js" type="text/javascript"></script>
    <!-- 公共样式表	，公共方法 -->
    <script src="../static/bootstrap/2.3.1/js/bootstrap.min.js" type="text/javascript"></script>
    <!-- 日历JS -->
    <script type="text/javascript" src="../static/bootstrap/dist/js/moment.js"></script>
    <script type="text/javascript" src="../static/bootstrap/dist/js/daterangepicker.js"></script>
    <!-- <script type="text/javascript" src="../static/bootstrap/dist/js/locales/bootstrap-datetimepicker.zh-CN.js"></script> -->

    <title>运行策略设置</title>
    <meta name="decorator" content="default">
    <style type="text/css">
        .col-md-3 {
            width: 24.8%;
            float: left;
            border-bottom: 1px solid #a1a1a1;
            border-right: 1px solid #a1a1a1;
            height: 188px;
            background: #ccc;
            position: relative;
        }

        .container-fluid {
            margin: 0;
            padding: 0;
        }

        .bj-row {
            position: relative;
            width: 100%;
        }

        .content-row {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }

        .panel-heading1 {
            background-color: #eee;
            cursor: pointer;
            width: 100%;
        }

        .panel-title1 {
            font-size: 22px;
            margin: 0 15px;
            padding-top: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .panel-body1 {
            cursor: pointer;
            background-color: #eee;
            padding: 5px;
            line-height: 24px;
            padding-left: 20px;
        }

        .obox {
            height: 28px;
            line-height: 28px;
            padding-right: 15px;
            color: #2750A4;
            background: #E3E3E3;
        }

        .tmk {
            display: none;
            width: 100%;
            height: 100%;
            background: #000;
            color: #9E9E9E;
            position: absolute;
            bottom: 0px;
            font-size: 12px;
            background: rgba(0, 0, 0, 0.4);
        }

        .obox img {
            padding-left: 10px;
        }

        .obox span {
            display: inline-block;
            padding-left: 0;
            font-size: 12px;
        }

        .oboxUseing {
            color: #294AA6 !important;
        }

        .obox .obtn {
            width: 40px;
            text-align: left;
        }

        .obox .del {
            text-align: right;
        }

        .obox span {
            font-size: 12px;
            color: #737373;
            padding-left: 10px;
        }

        .obox .obtn:hover {
            font-size: 15px;
            color: #3884D3;
            cursor: pointer;
        }

        .cards_item .panel-primary {
            border-top: 3px solid #fff;
        }

        .cards_item .panel-primary:hover {
            color: #3884D3;
            box-shadow: -1px 1px 4px 3px #888888 !important;
            z-index: 100;
            background: red;
            position: absolute;
            width: 100%;
        }

        .tsk {
            width: 185px;
            height: 70px;
            background: #fff;
            padding-left: 10px;
            padding-top: 15px;
            color: #9E9E9E;
            position: absolute;
            left: 50%;
            top: 50%;
            font-size: 12px;
            transform: translate(-50%,-50%);
        }

        .tsk span {
            padding-left: 5px;
        }

        .tsk div {
            padding-top: 8px;
            float: right;
            margin-right: 10px;
        }

        .tsk div button:nth-child(1) {
            color: #A6A6A6;
            background: #F3F3F3;
            border: 1px solid #E6E6E6;
            border-radius: 5px;
            width: 48px;
            margin-right: 5px;
        }

        .tsk div button:nth-child(2) {
            color: #B36663;
            background: #F3F3F3;
            border: 1px solid #E6E6E6;
            border-radius: 5px;
            width: 48px;
        }

        .butCenter {
            text-align: right !important;
        }

        .weekchoose {
            display: inline-block;
            float: left;
            width: 232px;
            margin-left: 0!important;
        }

        #weekCheck input {
            margin: 0 8px;
            width: auto;
            height: auto;
        }

        .modal {
            width: 460px;
        }

        .demo {
            position: relative;
        }

        .demo i {
            position: absolute;
            bottom: -25px;
            right: 0px;
            top: auto;
            cursor: pointer;
        }

        .col-md-3 {
            padding: 0;
        }

        .panel {
            border-radius: 0;
        }

        #myModal {
            display: none;
        }

        .daterangepicker .calendar th, .daterangepicker .calendar td {
            font-size: 14px;
            padding: 0;
        }
    </style>
</head>
<body>
<!-- 主显示部分 -->
<div class="container-fluid">
	<div class="smart_bread" style="margin-left:22px;"></div>
    <div class="bj-row">
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="col-md-3"></div>
        <div class="content-row">
            <div id="templateAdd" onclick="showModel()" class="col-md-3">
                <div class="text-center"
                     style="display: flex;justify-content: center;align-items: center;;height: 189px;border-bottom: 1px solid #a1a1a1;border-right: 1px solid #a1a1a1;cursor: pointer;">
                    <img src="../static/images/addNew.png"/>
                    <span style="font-size: 18px;text-decoration-line: underline;margin-left: 10px;">添加新模式</span>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 添加新模式弹框 -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 422px;">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 class="modal-title">新增模式</h4>
    </div>
    <div class="modal-body">
        <form id="modeltemplateform" class="form-horizontal" onsubmit="return checkDisable();" method="post"
              novalidate="novalidate">
            <input id="id" name="id" type="hidden">

            <div class="control-group">
               <!--  <label class="control-label">名称：</label> -->
                 <label class="control-label"><span class="help-inline"><font color="red">*</font> </span>名称：</label>
                <div class="controls">
                    <input type="text" id="modelName_1" class="input-medium" placeholder="请输入名称" name="workModeName" required="required">
                </div>
            </div>
            <div id="newModelkind_1" class="control-group">
              <!--   <label class="control-label">策略类型：</label> -->
                <label class="control-label"><span class="help-inline"><font color="red">*</font> </span>策略类型：</label>

                <div class="controls">
                    <select id="modelKind_1" name="strategyCode" class="input-medium">
                        <option value=''></option>
                        <option value="区域">区域</option>
                        <option value='专业'>专业</option>
                    </select>
                </div>
            </div>
            <div id="newModelType_1" class="control-group">
                <!-- <label class="control-label">控制类型：</label> -->
                <label class="control-label"><span class="help-inline"><font color="red">*</font> </span>控制类型：</label>

                <div class="controls">
                    <select id="modelType_1" name="controlCode" class="input-medium">
                        <option value=''></option>
                        <option value="time">时间控制</option>
                        <option value='date'>日期控制</option>
                    </select>
                </div>
            </div>
            <div id="modelDegreeDiv" class="control-group">
                <!-- <label class="control-label">策略等级：</label> -->
                <label class="control-label"><span class="help-inline"><font color="red">*</font> </span>策略等级：</label>
                <div class="controls" >
                    <select id="modelDegree_1" name="modelDegree" class="input-medium" placeholder="请选择策略等级，0等级最高，5等级最低">
                        <option value=''></option>
                       <!--  <option value=0>0</option>-->
                        <option value=1>1</option>
                        <option value=2>2</option>
                        <option value=3>3</option>
                        <option value=4>4</option>
                        <option value=5>5</option> 
                    </select>
                </div>
            </div>
            <div id="modelDegreeTimeDiv" class="control-group" style="display:none">
                <!-- <label class="control-label">策略等级：</label> -->
                <label class="control-label"><span class="help-inline"><font color="red">*</font> </span>策略等级：</label>
                <div class="controls" >
                    <input id="modelDegreeTime" type="text" name="modelDegreeTime" class="input-medium">
                </div>
            </div>
            <div class="control-group seDate">
                <!-- <label class="control-label">起止时间：</label> -->
                <label class="control-label"><span class="help-inline"><font color="red">*</font> </span>起止时间：</label>

                <div class="controls demo">
                    <input type="text" id="seDate" name="seDate" class="input-medium">
                    <i class="glyphicon glyphicon-calendar fa fa-calendar"></i>
                </div>
            </div>
            <div id="weekCheck" class="control-group">
               <!--  <label class="control-label">星期设置：</label> -->
                <label class="control-label"><span class="help-inline"><font color="red">*</font> </span>星期设置：</label>

                <div class="controls weekchoose">
                    <input id="allBtn" type="checkbox" multiple="multiple" name="allname" value=''>全选
                    <input type="checkbox" id="workTime1" multiple="multiple" name="workTime" value='星期一'>周一
                    <input type="checkbox" id="workTime2" multiple="multiple" name="workTime" value="星期二">周二
                    <input type="checkbox" id="workTime3" multiple="multiple" name="workTime" value="星期三">周三
                    <input type="checkbox" id="workTime4" multiple="multiple" name="workTime" value="星期四">周四
                    <input type="checkbox" id="workTime5" multiple="multiple" name="workTime" value="星期五">周五
                    <input type="checkbox" id="workTime6" multiple="multiple" name="workTime" value="星期六">周六
                    <input type="checkbox" id="workTime7" multiple="multiple" name="workTime" value="星期日">周日
                </div>
            </div>
            <div id="btn" class="form-actions">
                <input id="btnCancel" class="btn" type="button" value="关闭" onclick="closePopUp()" style="margin-right:10px;">
                <input id="btnSubmit" class="btn" type="submit" value="保存">
            </div>
        </form>
    </div>
</div>
<div id="myModal2" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h4 id="myModalLabel">运行策略查看</h4>
    </div>
    <div class="modal-body">
        <iframe id="Iframe"></iframe>
    </div>
</div>
<script type="text/javascript">
    window.onload = function () {
    	/* loadDictByType("modelDegree_1","ruagDateLevel"); */
        updateConfig();
        $.ajax({
            headers: {
                "token": localStorage.getItem("token"),
            },
            url: APIHost + "/ruag/ruag/ruagModelTemplate/getList",
            type: "POST",
            data: {},
            dataType: "json",
            async: false, //或false,是否异步
            cache: false,
            success: function (res) {
                if (res.code === 1000) {
                    var item = res.data;
                    for (var i = 0; i < item.length; i++) {
                        addTemplate(item[i]);
                    }
                    //补充空白格子
                    $("#templateAdd").nextAll().remove();
                    if((item.length + 1) >= 20){
                        var remainder = 4 - (item.length + 1) % 4;
                        for(var j = 0; j < remainder; j++){
                            $("#templateAdd").after('<div class="col-md-3"></div>');
                        }
                    }
                } else if (res.code === 1003) {
                    //没有登录状态
                    $.jBox.alert('您没有登录状态，请先登录', '提示', {
                        closed: function () {
                            window.parent.location.href = APIHost + "/sys/sysLogin.html";
                        }
                    });
                } else if (res.code === 1002) {
                    //发生异常
                    $.jBox.alert(res.msg);
                } else if (res.code === 1004) {
                    //结果为空
                    $.jBox.alert(res.msg);
                }

            },
        });
        var cards_items = document.getElementsByName("cards_item");
        var colors = ["#1785ca"];
        for (var i = 0; i < cards_items.length; i++) {
            cards_items[i].style.borderTopColor = colors[i % colors.length];
        }

        $(".del").click(function (e) {
            e.stopPropagation();
            $(this).parents(".cards_item").siblings(".cards_item").find(".tmk").css({"display": "none"});
            $(this).parent().siblings(".tmk").css("display", "block");

        })

        $(".closetsk").click(function (e) {
            e.stopPropagation();
            $(".tmk").css("display", "none");
        })


    }
    //新增模式模板提交
    addTemplate = function (obj) {
        var str = '<div  class="col-md-3 cards_item ">';
        str += '<div  class="panel panel-primary" name="cards_item">';
        str += '<div onclick="showItems(' + "'" + obj.id + "'" + ',\'' + obj.workModeName + '\')" id="ModelObj' + obj.id + '" class="panel-heading1">';
        str = str + '<h3   class="panel-title1">' + obj.workModeName;
        str += '</h3></div>';
        str = str + '<div onclick="showItems(' + "'"+ obj.id + "'"+ ',\'' + obj.workModeName + '\')" class="panel-body1">控制类型: ' + obj.controlType + '<br>';
        str = str + '策略等级: ' + obj.modelDegree + '</br>';
        if (obj.controlCode == "time") {
            str = str + '起止日期: ' + '</br>'; 
        } else {
            str = str + '起止日期: ' + obj.startDate + ' ~ ' + obj.endDate + '</br>';
        }
        str = str + '策略类型: ' + obj.strategyType + '</div>';
        if (obj.status == "0"&& obj.controlCode == "date") {
            str += '<div class="obox">' + '<img src="../static/images//using.png" />' + '<span class="oboxUseing">未启用</span>' + '<span  class="del icon iconfont obtn pull-right">' + '删除' + '</span>' + '</span>' + '<span class="icon iconfont pull-right">' + '|' + '</span>' + '<span class="icon obtn iconfont pull-right"  onclick="showModel(' + "'" + obj.id + "'" + ')">' + '修改 ' + '</div>';
        }else if (obj.status == "3"&& obj.controlCode == "date") {
            str += '<div class="obox">' + '<img src="../static/images//using.png" />' + '<span class="oboxUseing">已过期</span>' + '<span  class="del icon iconfont obtn pull-right">' + '删除' + '</span>' + '</span>' + '<span class="icon iconfont pull-right">' + '|' + '</span>' + '<span class="icon obtn iconfont pull-right"  onclick="showModel(' + "'" + obj.id + "'" + ')">' + '修改 ' + '</div>';
        }else if ((obj.status == "0"||obj.status == "3")&& obj.controlCode == "time") {
            str += '<div class="obox">' + '<img src="../static/images//using.png" />' + '<span class="oboxUseing">未启用</span>' + '<span  class="del icon iconfont obtn pull-right">' + '删除' + '</span>' + '</span>' + '<span class="icon iconfont pull-right">' + '|' + '</span>' + '<span class="icon obtn iconfont pull-right"  onclick="showModel(' + "'" + obj.id + "'" + ')">' + '查看 ' + '</div>';
        } else {
            str += '<div class="obox">' + '<img src="../static/images//using.png" />' + '<span class="oboxUseing">应用中</span>' + '<span  class="del icon iconfont obtn pull-right">' + '删除' + '</span>' + '</span>' + '<span class="icon iconfont pull-right">' + '|' + '</span>' + '<span class="icon iconfont pull-right obtn"  onclick="showModel(' + "'" + obj.id + "'" + ')">' + '查看 ' + '</div>';
        }
        str += '<div class="tmk"><div class="tsk"><img src="../static/images//warn.png" /><span>' + '你确认要删除该模式么?' + '</span><div><button id="confirm_' + obj.id + '" onclick="comfirDelete(' + "'" + obj.id + "'" + ')">' + '确认' + '</button><button class="closetsk">' + '取消' + '</button></div></div></div>'
        str += '</div></div>';
        $("#templateAdd").before(str);
        $("#modelTemplateId_1").append("<option value='" + obj.id + "'>" + obj.workModeName + "</option> ");
        $(".panel ").mouseenter(function () {
            $(this).addClass("panel-primary-success1");
        });
        $(".panel ").mouseleave(function () {
            $(this).removeClass("panel-primary-success1");
        });
        $(".del").click(function (e) {
            e.stopPropagation();
            $(this).parents(".cards_item").siblings(".cards_item").find(".tmk").css({"display": "none"});
            $(this).parent().siblings(".tmk").css("display", "block");

        })
        $(".closetsk").click(function (e) {
            e.stopPropagation();
            $(".tmk").css("display", "none");
        })
        var cards_items = document.getElementsByName("cards_item");
        var colors = ["#279600", "#0060CA", "#950096", "#CC0000", "#FAAB35"];
        for (var i = 0; i < cards_items.length; i++) {
            cards_items[i].style.borderTopColor = colors[i % colors.length];

        }

    }
    //version2 确认删除模式
    var currentModeId = 0;
    comfirDelete = function (id) {
        $(".tmk").css("display", "none");
        currentModeId = id;
        var queryCondition = {id: currentModeId};
        //删除主表
        $.ajax({
            headers: {
                "token": localStorage.getItem("token"),
            },
            url: APIHost + "/ruag/ruag/ruagModelTemplate/delete",
            type: "POST",
            data: queryCondition,
            dataType: "json",
            success: function (res) {
                if (res.code === 1000) {
                    if (res.data.msg == "success") {
                        //提示删除成功
                        $.jBox.alert('删除成功', '提示', {
                            closed: function () {
                                $("#ModelObj" + currentModeId).remove();
                                $(".cards_item").remove();
                                window.onload();
                            }
                        });
                    } else if (res.data.msg == "start") {
                        $.jBox.alert('此策略正在开启中，不可删除！', '提示')
                    }
                } else if (res.code === 1003) {
                    //没有登录状态
                    $.jBox.alert('您没有登录状态，请先登录', '提示', {
                        closed: function () {
                            window.parent.location.href = APIHost + "/sys/sysLogin.html";
                        }
                    });
                } else if (res.code === 1002) {
                    //发生异常
                    $.jBox.alert(res.msg);
                } else if (res.code === 1004) {
                    //结果为空
                    $.jBox.alert(res.msg);
                }

            },
        });
    }
    $("input[name='allname']").click(function () {
        if ($("#allBtn").is(":checked")) {
            $("input[name='workTime']").prop("checked", true);
        } else {
            $("input[name='workTime']").prop("checked", false);
        }
    })
      $("input[name='workTime']").click(function () {
    	  var arr=[];
    	  $("input[name='workTime']:checked").each(function(){
    		  //由于复选框一般选中的是多个,所以可以循环输出 
    		  arr.push($(this).val()); 
    		 }); 
    	  if(arr.length==7){
    		  $("input[name='allname']").prop("checked", true);
    	  }else{
    		  $("input[name='allname']").prop("checked", false);
    	  }
    })
    function saveItem() {
        $("#modeltemplateform").ajaxSubmit({
            headers: {
                "token": localStorage.getItem("token"),
            },
            url: APIHost + "/ruag/ruag/ruagModelTemplate/save",
            type: 'POST',
            data: {},
            timeout: 5000,
            dataType: 'json',
            async: false, //或false,是否异步
            success: function (res) {
                if (res.code === 1000) {
                    var data = res.data;
                    if (data.msg == "success") {
                        $.jBox.alert('保存成功', '提示', {
                            closed: function () {
                                var url = APIHost + "/ruag/ruagModelIndex.html";
                                window.location.href = url;
                            }
                        });
                    } else if (data.msg == "repeat") {
                        $.jBox.alert("该策略名称已存在，请重新填写！", "提示")
                    } else if (data.msg == "faild") {
                        $.jBox.alert("保存失败！", "提示")
                    }
                } else if (res.code === 1003) {
                    //没有登录状态
                    $.jBox.alert('您没有登录状态，请先登录', '提示', {
                        closed: function () {
                            window.parent.location.href = APIHost + "/sys/sysLogin.html";
                        }
                    });
                } else if (res.code === 1002) {
                    //发生异常
                    $.jBox.alert(res.msg);
                } else if (res.code === 1004) {
                    //结果为空
                    $.jBox.alert(res.msg);
                }
            }
        });
    }
    //加载修改数据
    function updatepageload(paramId) {
        $.ajax({
            headers: {
                "token": localStorage.getItem("token"),
            },
            url: APIHost + '/ruag/ruag/ruagModelTemplate/getById',
            type: 'POST',
            async: false, //或false,是否异步
            data: {
                "id": paramId

            },
            timeout: 5000,
            dataType: 'json',
            success: function (res) {
            	console.log(res);
                if (res.code === 1000) {
                    var item = res.data;
                    $("#modeltemplateform label.error").remove();
                    $("#id").val(item.id);
                    $("#modelName_1").attr("readonly", "readonly");
                    $("#modelName_1").val(item.workModeName);
                    $("#modelKind_1").val(item.strategyCode).trigger("change");
                    $("#modelType_1").val(item.controlCode).trigger("change");
                    $("#modelDegree_1").val(item.modelDegree).trigger("change");
                    $("#modelKind_1").attr("disabled", "disabled");
                    $("#modelType_1").attr("disabled", "disabled");
                   /*  $("#modelDegree_1").attr("disabled", "disabled"); */
                    $("#seDate").val(item.startDate + " -" + item.endDate);
                    if (item.controlCode == "date") {
                        checkWeek(item.workTime);
                        $(".seDate").css("display", "");
                        $("#weekCheck").css("display", "");
                        $("#modelDegreeTimeDiv").css("display", "none");
                        if (item.status == "1") {
                            $("#seDate").attr("disabled", "disabled");
                            $("#modelDegree_1").attr("disabled", "disabled");
                            
                          /*   $("input[name='workTime']").each(function (i) {
                                $(this).attr("disabled", "disabled");
                            });  */           
                            $("input[name='workTime']").removeAttr("checked");
                            var workTimes=item.workTime.split(",");                           
                              for(var i=0;i<workTimes.length;i++){
                            	 if($("#workTime1").val()==workTimes[i]){
                            		 $("#workTime1").prop("checked", true);
                            	 }
                            	 if($("#workTime2").val()==workTimes[i]){
                            		 $("#workTime2").prop("checked", true);
                            	 }
                            	 if($("#workTime3").val()==workTimes[i]){
                            		 $("#workTime3").prop("checked", true);
                            	 }
                            	 if($("#workTime4").val()==workTimes[i]){
                            		 $("#workTime4").prop("checked", true);
                            	 }
                            	 if($("#workTime5").val()==workTimes[i]){
                            		 $("#workTime5").prop("checked", true);
                            	 }
                            	 if($("#workTime6").val()==workTimes[i]){
                            		 $("#workTime6").prop("checked", true);
                            	 }
                            	 if($("#workTime7").val()==workTimes[i]){
                            		 $("#workTime7").prop("checked", true);
                            	 }
                            	
                            }  
                            $("input[name='allname']").attr("disabled", "disabled");
                            $("#myModal .modal-title").text("查看模式");
                            $("#btn #btnSubmit").css("display", "none");
                        } else {
                            $("#seDate").removeAttr("disabled");
                            $("#modelDegree_1").removeAttr("disabled");
                            $("input[name='workTime']").each(function (i) {
                                $(this).removeAttr("disabled");
                            });
                            $("input[name='allname']").removeAttr("disabled");
                            $("input[name='workTime']").removeAttr("checked");//先将选中清空
                            var workTimes=item.workTime.split(",");                           
                            for(var i=0;i<workTimes.length;i++){
                          	 if($("#workTime1").val()==workTimes[i]){
                          		 $("#workTime1").prop("checked", true);
                          	 }
                          	 if($("#workTime2").val()==workTimes[i]){
                          		 $("#workTime2").prop("checked", true);
                          	 }
                          	 if($("#workTime3").val()==workTimes[i]){
                          		 $("#workTime3").prop("checked", true);
                          	 }
                          	 if($("#workTime4").val()==workTimes[i]){
                          		 $("#workTime4").prop("checked", true);
                          	 }
                          	 if($("#workTime5").val()==workTimes[i]){
                          		 $("#workTime5").prop("checked", true);
                          	 }
                          	 if($("#workTime6").val()==workTimes[i]){
                          		 $("#workTime6").prop("checked", true);
                          	 }
                          	 if($("#workTime7").val()==workTimes[i]){
                          		 $("#workTime7").prop("checked", true);
                          	 }
                          	
                          }  
                            $("#btn #btnSubmit").css("display", "");
                            $("#myModal .modal-title").text("修改模式");
                        }
                    } else {
                    	$("#modelDegreeTimeDiv").css("display", "block");
                    	$("#modelDegreeTime").val("0");
                    	$("#modelDegreeTime").attr("readonly", "readonly");
                        $(".seDate").css("display", "none");
                        $("#weekCheck").css("display", "none");
                        $("#myModal .modal-title").text("查看模式");
                        $("#btn #btnSubmit").css("display", "none");
                    }

                } else if (res.code === 1003) {
                    //没有登录状态
                    $.jBox.alert('您没有登录状态，请先登录', '提示', {
                        closed: function () {
                            window.location.href = APIHost + "/sys/sysLogin.html";
                        }
                    });
                } else if (res.code === 1002) {
                    //发生异常
                    $.jBox.alert(res.msg);
                } else if (res.code === 1004) {
                    //结果为空
                    $.jBox.alert(res.msg);
                }

            },
            error: function () {
				$.jBox.alert("服务器代码发生异常,请联系管理员!",'提示');

            }
        })
    }
    var validator;
    function clearModal() {
    	validator.resetForm();
        $("#id").val("");
        checkDisable();
        $("#modelName_1").val("");
        $("#modelKind_1").val("").trigger("change");
        $("#modelType_1").val("").trigger("change");
        $("#modelDegree_1").val("").trigger("change");
        $("#seDate").removeAttr("disabled").val("").css("display", "");
        $("input[name='workTime']").prop("checked", false);
        $("#modelName_1").removeAttr("readonly");
        $(".seDate").css("display", "");
        $("#btn #btnSubmit").css("display","");
        $("#modelDegreeDiv").css("display", "");
        $("#modelDegreeTimeDiv").css("display", "none");
        $("#weekCheck").css("display", "block");
        //$(".error").css("display", "none");
    }
    function checkWeek(workTime) {
        if (workTime != null) {
            var arr = workTime.split(",");
            chckBox = document.getElementsByName("workTime");
            num = arr.length;
            console.log(num);
            if(num==7){
      		  $("input[name='allname']").prop("checked", true);
      	  	}else{
      		  $("input[name='allname']").prop("checked", false);
      	  	}
            for (var i = 0; i < arr.length; i++) {
                for (var index = 0; index < num; index++) {
                    if (arr[i] == chckBox[index].value) {
                        $(chckBox[index]).attr("checked", true);
                        break;
                    }
                }
            }
        }

    }
    //新增/编辑 模式模板弹出框数据填充
    showModel = function (id) {
        $('#myModal').modal({backdrop: 'static', keyboard: false});
        $("#myModal").modal("show");
        //新增
        if (id) {
            updatepageload(id);
        } else {
            $("#myModal .modal-title").text("新增模式");
            $("#modelDegree_1").attr("placeholder","请选择策略等级，数字越小，优先级越高");
            clearModal();
        }
    }
    //模式类别select控件#modelType_1  change事件定义  新增/编辑模式模板都会调用
    //编辑工作模式时，若改变为临时模式，需将模式等级置为0
    //模式等级div 显示 设置  临时模式--不显示，计划模式--显示
    $("#modelType_1").change(function () {
        var modelType = $("#modelType_1").val();
        if (modelType == "time") {
            //$("#newmodelDegree_1").css("display", "none");
            $("#seDate").css("display", "none");
            $("#modelDegree_1").val(0);
            $("#modelDegreeDiv").css("display", "none")
            $("#weekCheck").css("display", "none");
            $(".seDate").css("display", "none");
        }
        if (modelType == "date") {
            //$("#newmodelDegree_1").css("display", "block");
            $("#modelDegreeDiv").css("display", "block");
            $("#seDate").css("display", "block");
            $("#weekCheck").css("display", "block");
            $(".seDate").css("display", "block");
            checkDisable();
        }
    });
    function checkDisable() {
        $("select[disabled=disabled]").each(function () {
            if (parseInt($(this).val()) != -1) {
                $(this).attr("disabled", false);
            }
        });
        return true;
    }
    function showItems(id, name) {
        window.location.href = APIHost + "/ruag/ruagModelDetail.html?id=" + id;
    }
    // 关闭弹框
    function closePopUp() {
        $('#myModal').modal("hide");
    }
</script>
<script>
	$(document).ready(function() {
		// 制作面包屑导航
		makeBread();
	}); 
    // 表单验证
    $.validator.setDefaults({
        submitHandler: function () {
            // 调用提交
            saveItem();
        }
    });
    $().ready(function () {
        // 在键盘按下并释放及提交后验证提交表单
       validator=$("#modeltemplateform").validate({
            rules: {
                workModeName: {
                    required: true,
                },
                controlCode: {
                    required: true,
                },
                strategyCode: {
                    required: true,
                },
                modelDegree: {
                    required: true,
                },
                seDate: {
                    required: true,
                },
                workTime: {
                    required: true,
                },
            },
            messages: {
                workModeName: {
                    required: "请填写运行策略名称",
                },
                controlCode: {
                    required: "请选择控制类型",
                },
                strategyCode: {
                    required: "请选择策略类型",
                },
                modelDegree: {
                    required: "请选择优先级",
                },
                seDate: {
                    required: "请选择起止时间",
                },
                workTime: {
                    required: "请选择星期设置",
                },
            },
            errorPlacement: function (error, element) {
                error.appendTo(element.parent());
            }
        });
    })
    function updateConfig() {
        //时间插件
        $('#seDate span').html(moment().subtract('hours', 1).format('yyyy-MM-dd') + ' - ' + moment().format('yyyy-MM-dd'));

        $('#seDate').daterangepicker(
                {
                    // startDate: moment().startOf('day'),
                    //endDate: moment(),
                    minDate: GetDateStr(),    //最小时间
                    //maxDate : moment(), //最大时间
                    //dateLimit : {
                    //days : 30  
                    //}, //起止时间的最大间隔
                    showDropdowns: true,
                    showWeekNumbers: false, //是否显示第几周
                    timePicker: false, //是否显示小时和分钟
                    timePickerIncrement: 60, //时间的增量，单位为分钟
                    timePicker12Hour: false, //是否使用12小时制来显示时间
                    /*  ranges : {
                     //'最近1小时': [moment().subtract('hours',1), moment()],
                     '今日': [moment().startOf('day'), moment()],
                     '昨日': [moment().subtract('days', 1).startOf('day'), moment().subtract('days', 1).endOf('day')],
                     '最近7日': [moment().subtract('days', 6), moment()],
                     '最近30日': [moment().subtract('days', 29), moment()]
                     }, */
                    opens: 'right', //日期选择框的弹出位置
                    buttonClasses: ['btn btn-default'],
                    applyClass: 'btn-small btn-primary blue',
                    cancelClass: 'btn-small',
                    separator: ' to ',
                    locale: {
                        applyLabel: '确定',
                        cancelLabel: '取消',
                        fromLabel: '起始时间',
                        toLabel: '结束时间',
                        format: 'YYYY/MM/DD', //控件中from和to 显示的日期格式
                        customRangeLabel: '自定义',
                        daysOfWeek: ['日', '一', '二', '三', '四', '五', '六'],
                        monthNames: ['一月', '二月', '三月', '四月', '五月', '六月',
                            '七月', '八月', '九月', '十月', '十一月', '十二月'],
                        firstDay: 1
                    }
                }, function (start, end, label) {//格式化日期显示框

                    $('#seDate span').html(start.format('yyyy-MM-dd') + ' - ' + end.format('yyyy-MM-dd'));
                });
    }
    function GetDateStr() {
    	var day3 = new Date();
    	day3.setTime(day3.getTime()+24*60*60*1000);
    	var s3 = day3.getFullYear()+"-" + (day3.getMonth()+1) + "-" + day3.getDate();
    	return s3;
    }
</script>
</body>
</html>