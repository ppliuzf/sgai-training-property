<html>
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
	<meta name="renderer" content="webkit">
	<meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10">
	<meta http-equiv="Expires" content="0">
	<meta http-equiv="Cache-Control" content="no-cache">
	<meta http-equiv="Cache-Control" content="no-store">
	<script src="../static/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
	<link href="../static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css" type="text/css" rel="stylesheet">
	<script src="../static/bootstrap/2.3.1/js/bootstrap.min.js" type="text/javascript"></script>
	<link href="../static/bootstrap/2.3.1/awesome/font-awesome.min.css" type="text/css" rel="stylesheet">

	<link href="../static/jquery-validation/1.11.0/jquery.validate.min.css" type="text/css" rel="stylesheet">
	<script src="../static/jquery-validation/1.11.0/jquery.validate.min.js" type="text/javascript"></script>
	<link href="../static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css" rel="stylesheet">
	<script src="../static/jquery-jbox/2.3/jquery.jBox-2.3.min.js" type="text/javascript"></script>
	<script src="../static/My97DatePicker/WdatePicker.js" type="text/javascript"></script>
	<link href="../static/My97DatePicker/skin/WdatePicker.css" rel="stylesheet" type="text/css">
	<script src="../static/common/mustache.min.js" type="text/javascript"></script>
	<link href="../static/common/smart.min.css" type="text/css" rel="stylesheet">
	<script src="../static/common/smart.min.js" type="text/javascript"></script>
	<script type="text/javascript">
		var ctx = '/admin', ctxStatic = '/static';
	</script>
	<script src="../static/jquery-select2/4.0/select2.min.js" type="text/javascript"></script>
    <script src="../static/jquery-select2/4.0/zh-CN.js" type="text/javascript"></script>
    <link href="../static/jquery-select2/4.0/select2.min.css" rel="stylesheet">
	<script src="../static/jquery-form/3.51.0/jquery.form.js"	type="text/javascript"></script>
	<script src="../config/smart-common.js" type="text/javascript"></script>
	<script	src="../static/paginator/bootstrap-paginator.js" 	type="text/javascript"></script>
	<script	src="../static/echart/echarts.js" 	type="text/javascript"></script>
	<link href="../static/media/css/my-style.css" rel="stylesheet" type="text/css"/>
	<script src="../static/media/js/main.js" type="text/javascript"></script>
	<title>首页-添加图表</title>
	<meta name="decorator" content="default">
	<style>
		.nav-content{
			position: relative;
			height: 35px;
		}
		.nav-content .nav-tabs{
			margin-bottom: 0;
			border-bottom: 0;
		}
		.nav-content .nav-tabs>li>a{
			width: 120px;
			height: 36px;
			font-size: 16px;
			color: #8a92a8;
			text-align: center;
			background-color: #edeff5;
			border-top: 4px solid #d6dbea;
			border-bottom: 1px solid #ddd;
			box-sizing: border-box;
		}
		.nav-content .nav-tabs>.active>a{
			color: #666;
			background-color: #fff;
			border-top: 4px solid #3399cc;
			border-bottom: 0;
		}
		.nav-content .nav-tabs>li>.addChartBtn{
			width: 50px;
			padding-top: 12px;
			border: 0;
			border-bottom: 1px solid #ddd;
			background-color: #edeff5;
			color: #8a92a8;
		}
		.nav-content .actions{
			position: absolute;
			right: 0;
			top: 0;
		}
		.tab-content{
			overflow: hidden;
			border: 1px solid #E0E0E0;
			border-radius: 0 4px 4px 4px;
			-webkit-box-shadow: inset 0 0 4px rgba(0,0,0,0.075);
			-moz-box-shadow: inset 0 0 4px rgba(0,0,0,0.075);
			box-shadow: 0 0 4px rgba(0,0,0,0.075);
		}
		.tab-content .tab-pane{
			padding: 10px;
			overflow: hidden;
		}
		.book-item {
			float: left;
			border-radius: 2px;
			box-sizing: border-box;
			display: inline-block;
			font-family: arial, sans-serif;
			font-size: 12px;
			height: 300px;
			line-height: 100%;
			margin: 10px 1%;
			opacity: 1;
			overflow: hidden;
			position: relative;
			vertical-align: top;
			white-space: nowrap;
			width: 48%;
			box-shadow: 0 0 5px rgba(0,0,0,0.3);
		}
		/*.book-item:hover {
			box-shadow: 0 0 5px rgba(0,0,0,0.3);
		}*/
		.book-title {
			padding: 0 10px;
			width: 100%;
			height: 35px;
			border-bottom: 1px solid #ddd;
			box-sizing: border-box;
		}
		.book-title p{
			height: 34px;
			line-height: 34px;
			text-indent: 3px;
			color: #666;
			margin: 0;
			float: left;
			font-size: 14px;
			font-weight: bold;
		}
		.book-item .main {
			width: 100%;
			height: 265px;
		}
		.book-item .addChartBtn{
			display: block;
			width: 100%;
			height: 100%;
			line-height: 240px;
			font-size: 24px;
			color: #d3d6e3;
			border-radius: 4px;
			text-align: center;
			background-color: #f5f6fa;
			text-decoration: none;
		}
		.book-item .addChartBtn span{
			display: inline-block;
			margin-right: 15px;
			font-size: 28px;
			vertical-align: middle;
		}
		.middle_msg{
			margin-left: 15px;
			color: #000000;
		}
		.btn-over  {
    		margin: 0;
    		padding: 0 8px;
    		font-size: 12px;
    		height: 18px;
    		line-height: 17px;
    		color: #fff;
    		border:1px solid #666666;
    	}
    	.message_detail li span a{
    		font-size: 12px;
    		color: #0066cc;
		    border-right: 1px solid #cccccc;
		    display: inline-block;
		    height: 14.5px;
		    line-height: 14.5px;
    	}
    	#event_detail li span a{
			width: 125px;
		    
    	}
    	#alm_detail li span a{
			width: 160px;
    	}
    	.btn_status{
    		float: left;
    		margin-top:2px;
    		background: #cc3300;
    	}
    	.wait_state button{
    		border-radius: 0 !important;
    		-webkit-border-radius:0 !important;
    		-moz-border-radius:0 !important;
    	}
    	.btn_status_event{
    		margin-top:2px;
    		width: 42px;
    	}
    	.message_detail{
    		padding-top: 7px;
    	}
    	.message_detail li{
    		line-height: 23px;
    		min-width: 923px;
    	}
    	.message_item .event_icon a{
    		text-decoration:underline;
    		cursor: pointer;
    	}
    	#alm_total{
    		color:#CC0000;
    	}
    	.time_msg,.notice-time{
    		font-size: 12px;
    		color: #666666;
    		border-right: 1px solid #cccccc;
		    width: 125px;
			display: inline-block;
			height: 14.5px;
			line-height: 14.5px;
			margin-left: 15px;
    	}
    	#event_total {
    		color:#0066cc;
    	}
    	#notice_total {
    		color:#339900;
    	}
    	.home_content{
    		min-width: 1082px;
    	}
    	.notice-msg{
    		border:none !important;
    	}
	</style>
</head>
<body>
<div class="home_content">
	<div class="chart_box">
		<div class="nav-content">
			<ul id="navTabs" class="nav nav-tabs">
			<!-- //tab -->
			</ul>
		</div>
		<div id="tabContent" class="tab-content">
			<!-- //chart  -->
		</div>
	</div>
</div>
</div>
<div id="tipModal" class="modal hide fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div id="tipContent">
    </div>
</div>
<script >
	$(document).ready(function(){
		initilize();
	});
	function initilize(){
		initDataNow();
	}

	// 从后台获得图表数据
	function  initDataNow(){
		$.ajax({
			headers    : {
				"token" : localStorage.getItem("token")
			},
			url : APIHost + '/admin/ctl/ctlChart/findChartByUserCode',
			type : 'POST',
			async : false, //或false,是否异步
			timeout : 5000,
			data : {
				"homeShow" : "Y" ,
			},
			dataType : 'json',
			success : function(res) {
				//console.log(res);
				if(res.code === 1000){
					// 生成tab标签 及下面的图表
				    createCharts(res.data);
				}else if(res.code ===1003){
					//没有登录状态
				/* 	$.jBox.alert('您没有登录状态，请先登录', '提示',{ closed: function ()
					{ window.parent.location.href= APIHost + "/sys/sysLogin.html"; } }); */
				}else if(res.code === 1002){
					//发生异常
					$.jBox.alert(res.msg,"提示");
				}else if(res.code === 1004){
					//结果为空
					$.jBox.alert(res.msg,"提示");
				}
			},
			error : function() {
				console.log("错误");
			}
		});
	}
	// 从后台获得图表数据
	function  refreshData(id){
		$.ajax({
			headers    : {
				"token" : localStorage.getItem("token")
			},
			url : APIHost + '/admin/ctl/ctlChart/findOptionById',
			type : 'POST',
			async : false, //或false,是否异步
			timeout : 5000,
			data : {
				"id" : id ,
			},
			dataType : 'json',
			success : function(res) {
				//console.log(res);
				if(res.code === 1000){
					// 生成tab标签 及下面的图表
					$("#"+res.data.id).html("");
				    var chart = echarts.init(document.getElementById(res.data.id));
					chart.setOption(eval("("+res.data.option+")"));
				}else if(res.code ===1003){
					//没有登录状态
				/* 	$.jBox.alert('您没有登录状态，请先登录', '提示',{ closed: function ()
					{ window.parent.location.href= APIHost + "/sys/sysLogin.html"; } }); */
				}else if(res.code === 1002){
					//发生异常
					$.jBox.alert(res.msg,"提示");
				}else if(res.code === 1004){
					//结果为空
					$.jBox.alert(res.msg,"提示");
				}
			},
			error : function() {
				console.log("错误");
			}
		});
	}
	// 每隔三十秒刷新一次图表信息
	 var intervalLoadEchart = setInterval(function() { 
    	initDataNow();
  	}, 60000); 
	//  初始化 图表----加载 tab页 和其下面的图表 （全部加载）
	function createCharts(datas){
		$("#navTabs,#tabContent").html("");
		var dataTab ="root";
		for (var i = 0; i < datas.length; i++) {
			var data = datas[i];
			dataTab = data.id;
			var tab = '<li><a href=#' + data.id +' data-toggle="tab">' + data.chartName + '</a></li>';
			$(".nav-tabs").append(tab);
			console.log(tab);
			var tabPane = '<div id=' + data.id + ' class="tab-pane"></div>';
			$("#tabContent").append(tabPane);
			console.log("tabPane:"+tabPane);
			if(data.childrenCharts.length > 0){
				var chartItems = []
				for(var j = 0;j<data.childrenCharts.length; j++){
					var chartData = data.childrenCharts[j];
					var chartItem = '<div class="book-item">' +
							'<div class="book-title">' +
							'<p>'+ chartData.chartName +'</p>' +   //chartData.option.title.text
							'</div>'+
							'<div id='+ chartData.id +' class="main"></div>'+
							'</div>' +
							'</div>';
					$('#' + data.id).append(chartItem);
					var chartWidth = ($("#tabContent").width() - 20) * 0.48;
					$("#" + chartData.id).css({"width":chartWidth});
					var chart = echarts.init(document.getElementById(chartData.id));
					if(chartData.option!=null){
						chart.setOption(  eval("("+chartData.option+")"));
					}
					/*  if(chartData.remarks!="null"){
						 console.log(chartData.remarks);
						 setInterval(function() { 
							refreshData(chartData.id);
					  	},  Number(chartData.remarks));
					}   */
				}
				//
				var chartItemAdd = '<div class="book-item"><a class="addChartBtn" '+
				       'href="/sys/homeAdd.html?#'+ data.id +'"'+
			           '><span class="icon-plus-sign-alt" ></span>添加新项目</a>'+
			           ' </div>' 
			    $('#' + data.id).append(chartItemAdd);      
			}
		}
		 var addBtnTab = '<li><a class="addChartBtn" href="/sys/homeAdd.html?#'+dataTab +'">';
		 addBtnTab += '<span class="icon-plus"></span></a></li>';
		 $(".nav-tabs").append(addBtnTab);
		 $(".nav-tabs a:first").tab("show");
		 var tabContentHeight = $("#tabContent").height();
		 $("#tabContent").height(tabContentHeight)
	}
</script>
</body>
</html>