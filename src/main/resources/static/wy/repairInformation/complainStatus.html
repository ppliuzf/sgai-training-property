<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10">
<meta http-equiv="Expires" content="0">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Cache-Control" content="no-store">
<script src="../static/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
<link href="../static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css"
	type="text/css" rel="stylesheet">
<link href="../static/bootstrap/2.3.1/awesome/font-awesome.min.css"
	type="text/css" rel="stylesheet">
<link href="../static/bootstrap/2.3.1/awesome/font-awesome.min.css"
	type="text/css" rel="stylesheet">

<!--分页  -->
<script src="../static/paginator/bootstrap-paginator.js"
	type="text/javascript"></script>
<!-- 公共样式表	，公共方法 -->
<link href="../static/media/css/my-style.css" rel="stylesheet"
	type="text/css" />
<script src="../static/media/js/main.js" type="text/javascript"></script>

<!-- <link href="../static/jquery-select2/4.0/select2.min.css" rel="stylesheet"> -->
<link href="../static/jquery-validation/1.11.0/jquery.validate.min.css"
	type="text/css" rel="stylesheet">
<link href="../static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css"
	rel="stylesheet">
<link href="../static/My97DatePicker/skin/WdatePicker.css"
	rel="stylesheet" type="text/css">
<link href="../static/common/smart.min.css" type="text/css"
	rel="stylesheet">
<script src="../static/bootstrap/2.3.1/js/bootstrap.min.js"
	type="text/javascript"></script>
<!-- <script src="../static/jquery-select2/4.0/select2.min.js" type="text/javascript"></script> -->
<script src="../static/jquery-validation/1.11.0/jquery.validate.min.js"
	type="text/javascript"></script>
<script src="../static/jquery-jbox/2.3/jquery.jBox-2.3.src.js"
	type="text/javascript"></script>
<script src="../static/My97DatePicker/WdatePicker.js"
	type="text/javascript"></script>
<script src="../static/common/mustache.min.js" type="text/javascript"></script>
<script src="../static/common/smart.min.js" type="text/javascript"></script>
<script src="../../config/smart-common.js" type="text/javascript"></script>
<script src="../static/wy/area.js" type="text/javascript"></script>
<script src="../static/echart/echarts.js" type="text/javascript"></script>
<style  type="text/css">
	.map-title{
		padding:10px;
		border-bottom:1px solid #ddd;
	}
</style>
</head>
<body>
<input type="hidden" value="0" id="flag">
	<div id="chooseDate2" class="hide"
		style="position: absolute; border: 1px solid; left: 80px; top: 160px; background: #FFFFFF; width: 400px; padding-bottom: 20px; z-index: 100; text-align: center;">
		<div id="importFormSureChange2" action="" method="post"
			enctype="multipart/form-data" class="form-search"
			style="padding-left: 20px; text-align: center; margin-bottom: 5px !important">
			<br />
			<div class="control-group" style="margin-top: 9px;">

				<div class="controls">
					<label for="customer-name" class="control-label"><b>动态时间:</b></label>
					<select id="datetype2" name="datetype" onchange="find1(this.value)"
						class="query_input" style="width: 230px;">
					</select>
				</div>
			</div>

		</div>
		<div id="searchForm2" class="form-search hide"
			;
			style="padding-left: 20px; text-align: center; margin-top: 5px !important"
			method="post" style="display: none">
			<div class="controls" style="margin-top: 5px">

				<div>
					<label for="customer-name" class="control-label"><b>时间从:</b></label>
					<input id="startTime2" name="startTime" class="query_input Wdate"
						type="text" onclick="WdatePicker()" />
				</div>
			</div>
			<div class="controls" style="margin-top: 10px">

				<div>
					&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label
						for="customer-name" class="control-label"><b>至:</b></label> <input
						id="endTime2" name="endTime" class="query_input Wdate" type="text"
						onclick="WdatePicker()"
						onfocus="WdatePicker({onpicked:function(dp){fresh1('e'); }})" />
				</div>
			</div>

		</div>
		<!-- <input id="btnSubmitLog2"
				class="btn btn-primary btn_middle small_blue hide" type="button"
				value="查询" onclick="fresh1('e');"></input>
	<input type="button" class="btn btn-primary" value="关闭"
				onclick="closedivChange2()" /> -->

	</div>
			<div id="chooseDate3" class="hide"
	style="position: absolute; border: 1px solid; left: 635px; top: 164px; background: #FFFFFF; width: 400px; padding-bottom: 20px; z-index: 100; text-align: center;">
		<div id="importFormSureChange3" action="" method="post"
			enctype="multipart/form-data" class="form-search"
			style="padding-left: 20px; text-align: center;margin-bottom:5px !important">
			<br />
			<div class="control-group" style="margin-top: 9px;">
				
				<div class="controls">
				<label for="customer-name" class="control-label"><b>动态时间:</b></label>
					<select id="datetype3" name="datetype" onchange="find2(this.value)"
						class="query_input" style="width: 230px;">
					</select>
				</div>
			</div>
			
		</div>
		<div id="searchForm3" class="form-search hide";
			style="padding-left: 20px; text-align: center;margin-top:5px !important" method="post"
		style="display: none">
			<div class="controls" style="margin-top:5px">
				
				<div>
				<label for="customer-name" class="control-label"><b>时间从:</b></label>
					<input id="startTime3" name="startTime" class="query_input Wdate" type="text" onclick="WdatePicker()" />
				</div>	
			</div>
			<div class="controls" style="margin-top:10px">
				
				<div>
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<label for="customer-name" class="control-label"><b>至:</b></label>
					<input id="endTime3" name="endTime" class="query_input Wdate" type="text" onclick="WdatePicker()" onfocus="WdatePicker({onpicked:function(dp){fresh2('e'); }})"/>
				</div>
			</div>
		
	</div>
	<!-- <input id="btnSubmitLog3"
				class="btn btn-primary btn_middle small_blue hide" type="button"
				value="查询" onclick="fresh2('e');"></input>
	<input type="button" class="btn btn-primary" value="关闭"
				onclick="closedivChange3()" /> -->
	
	</div>
	<div style="overflow: hidden; width: 100%">
	<!-- <div
		style="margin-top: 5px; color: black; font-Size: 15px; font-Weight: normal; font-Family: 宋体; font-Style: normal"
		class="hide" id="showTitle1">投诉状态分布</div>
	<div
		style="width: 45%; height: 400px; position: relative; float: left;">
		<div
			style="width: 100%; height: 400px; position: absolute; left: 0px; top: 0px"
			id="css21"></div>
		<div id="repairbox3" style="width: 100%; height: 400px; float: left">
			//chart 

		</div>
	</div> -->
	<div style="width: 44%; height: 400px;position:relative;float:left;border:1px solid #ddd;margin-left:4%;margin-right:4%;" >
		<div class="map-title">投诉状态分布</div>
		<div style="width: 100%; height: 400px;position:absolute;left:0px;top:0px" id="css21">
			</div>
			<div id="repairbox3" style="width: 100%; height: 350px; float: left;border:1px   ">
			<!-- //chart  -->
			
		</div>
		</div>
	
		<div style="width: 44%; height: 400px;position:relative;float:left;border:1px solid #ddd;" id="css3">
		<div class="map-title">投诉状态时间间隔
		</div>
		<div style="width: 100%; height: 339px;position:absolute;left:0px;top:0px;margin-top: 10%;" >
			</div>
			<div id="box3" style="width: 100%; height:350px; float: left;border:1px ;margin-right:4%;">
			<!-- //chart  -->
			
		</div>
		</div>
	</div>
	<script src="../static/echart/echarts.min.js"></script>
	<script>
		$(document).ready(function() {
			fresh1();
			fresh2();
		});

		function fresh1(id) {
			$("#chooseDate2").hide();
			$("#searchForm2").hide();
			$("#flag").val('0');
			var css = {
				"background-color" : '#FFFFFF',
				"z-index" : "0",
				"opacity" : "0"
			};
			$("#css21").css(css);
			var fontSize = 10;
			var rich = {
				yellow : {
					color : "#ffc72b",
					fontSize : fontSize * 2,
					padding : [ 5, 4 ],
					align : 'center'
				},
				total : {
					color : "#ffc72b",
					fontSize : fontSize * 4,
					align : 'center'
				},
				white : {
					color : "#9a8169",
					align : 'center',
					fontSize : fontSize * 1.4,
				},
				blue : {
					color : '#49dff0',
					fontSize : fontSize * 1.4,
					align : 'center'
				},
				hr : {
					borderColor : '#0b5263',
					width : '100%',
					borderWidth : 1,
					height : 0,
				}
			}
			$
					.ajax({
						headers : {
							"token" : localStorage.getItem("token")
						},
						url : APIHost + '/admin/complain/pieData',
						type : 'POST',
						async : false, //或false,是否异步
						timeout : 3000,
						data : {
							id : id,
							startTime : $("#startTime2").val(),
							endTime : $("#endTime2").val(),
							type:"1"
						},
						dataType : 'json',
						success : function(data) {

							/* 	require.config({
							      paths: {
							          echarts: 'http://echarts.baidu.com/build/dist'
							      }
							  });
							  require(
							      [
							          'echarts',
							          'echarts/chart/pie',
							          'echarts/chart/bar',
							          'echarts/chart/line'
							      ], */
							//  function(ec){
							var res = [];
							for ( var j in data) {
								if (j != 'repairSum') {
									res.push({
										value : data[j],
										name : j
									})
								}
							}
							;
							option = {
								backgroundColor : '#fff',
								title : {
									text : '投诉工单总数(条):' + data["repairSum"],
									subtext : "",
									x : 'center',
									y : 'center',
									textStyle : {
										fontWeight : 'normal',
										fontSize : 16
									}
								},
								toolbox : {
									show : true,
									feature : {
										myTool : {
											show : true,
											title : '筛选',
											icon : 'path://M837 139.3L573.2 464.6 562 478.3V853.4L462 803V478.3l-11.2-13.8L187 139.3h650m105-50H82L412 496v337.8l200 100.8V496.1L942 89.3z',
											onclick : function() {
												if ($("#flag").val() == '1') {
													alert("还有未关闭的窗口!请先关闭，才能点击！");
													return;
												}
												$("#flag").val('1');
												$("#chooseDate2").show();
												$("#chooseDate1").hide();
												$("#chooseDate3").hide();
												$("#chooseDate4").hide();
												var css = {
													"background-color" : '#888888',
													"z-index" : "1",
													"opacity" : "0.3"
												};
												$("#css21").css(css);

												var obj = document
														.getElementById('datetype2');
												obj.options.length = 0;//移除options 
												$
														.ajax({
															headers : {
																"token" : localStorage
																		.getItem("token")
															},
															url : APIHost
																	+ '/admin/complain/getDates',
															type : 'POST',
															async : false, //或false,是否异步
															timeout : 5000,
															dataType : 'json',
															success : function(
																	res) {
																$('#datetype2')
																		.append(
																				"<option hidden='hidden' value=''></option>");
																for (i in res) {
																	$(
																			'#datetype2')
																			.append(
																					"<option value="+i+">"
																							+ res[i]
																							+ "</option>");
																}
																$('#datetype2')
																		.append(
																				"<option  value='e'>自定义</option>");
															},
															error : function() {
																console
																		.log("错误");
															}
														});
											}
										}
									}
								},
								tooltip : {
									trigger : 'item',
									formatter : "{b}<br/>{c} ({d}%)",
									textStyle : {
										fontSize : fontSize * 1.6
									}
								},
								series : [ {
									name : 'pie',
									type : 'pie',
									radius : [ '40%', '60%' ],
									hoverAnimation : false,
									color : [ '#7EC0EE', '#7FFFD4', '#87CEFF',
											'#7A67EE', '#48D1CC', '#104E8B' ],
									label : {
										normal : {
											formatter : function(params,
													ticket, callback) {
												var total = 0; //考生总数量
												var percent = 0; //考生占比
												res.forEach(function(value,
														index, array) {
													total += value.value;
												});
												if (total != 0) {
													percent = ((params.value / total) * 100)
															.toFixed(2);
												}
												return '{white|' + params.name
														+ '}\n{yellow|'
														+ params.value
														+ '}{blue|' + percent
														+ '%}';
											},
											rich : rich
										},
									},
									data : res
								} ]
							};
							//$("#showTitle1").show();
							var myChartpie = echarts.init(document
									.getElementById('repairbox3'));
							myChartpie.setOption(option);
							//}
							//)
						}
					});
		}
		function find1(id) {
			if (id == 'e') {
				$("#startTime2").val("");
				$("#endTime2").val("");
				$("#searchForm2").show();
				$("#btnSubmitLog2").show();
			} else {
				$("#searchForm2").hide();
				$("#btnSubmitLog2").hide();
				fresh1(id);
			}
		}
		function fresh2(id) {
			$("#chooseDate3").hide();
			$("#searchForm3").hide();
			$("#flag").val('0');
			$("#css3").css("background-color","#FFFFFF");
			$.ajax({
				headers : {
					"token" : localStorage.getItem("token")
				},
				url : APIHost + '/repairInformation/freshReportComplain',
				type : 'POST',
				async : false, //或false,是否异步
				data : {
					id : id,
					startTime1 : $("#startTime3").val(),
					endTime1 : $("#endTime3").val(),
					type:1
					
				},
				dataType : 'json',
				//contentType: "application/json; charset=utf-8",
				success : function(res) {
					/* require.config({
						paths : {
							echarts : 'http://echarts.baidu.com/build/dist'
						}
					});
					require([ 'echarts', 'echarts/chart/pie',
							'echarts/chart/bar', 'echarts/chart/line' ],
							function(ec) { */
								var monday = 0;
								var tuesday = 0;
								var Wednesday = 0;
								var thursday = 0;
								var friday = 0;
								var saturday = 0;
								var sunday = 0;
								for (i in res) {
									console.log(res[i]);
									if (0 < res[i].count && res[i].count <= 1) {
										monday++;
									} else if (1 < res[i].count
											&& res[i].count <= 7) {
										tuesday++;
									} else if (7 < res[i].count
											&& res[i].count <= 15) {
										Wednesday++;
									} else if (15 < res[i].count
											&& res[i].count <= 30) {
										thursday++;
									} else if (30 < res[i].count
											&& res[i].count <= 60) {
										friday++;
									} else if (60 < res[i].count
											&& res[i].count <= 90) {
										saturday++;
									} else if (90 < res[i].count) {
										sunday++;
									}

								}
								// 基于准备好的dom，初始化echarts图表
								var option2 = {
										title : {
											text : '',
											//subtext : "投诉状态时间间隔",
											top : '-3%',
											subtextStyle : {
												color:'black',
												fontStyle:'normal',
												fontSize : 15,
												fontWeight:'normal',
												fontFamily:'宋体'
											}
										},
									    toolbox: {  
					    		            show : true,  
					    		            feature : {  
					    		            myTool : {  
					    		                    show : true,  
					    		                    title : '筛选',  
					    		                    icon: 'path://M837 139.3L573.2 464.6 562 478.3V853.4L462 803V478.3l-11.2-13.8L187 139.3h650m105-50H82L412 496v337.8l200 100.8V496.1L942 89.3z',
					    		                    onclick : function (){ 
					    		                    	if($("#flag").val()=='1'){
					    		                    		alert("还有未关闭的窗口!请先关闭，才能点击！");
					    		                    		return;
					    		                    	}
					    		                    	$("#flag").val('1');
					    		                    	$("#chooseDate3").show();
					    		                    	$("#chooseDate1").hide();
					    		                    	$("#chooseDate2").hide();
					    		                    	$("#chooseDate4").hide();
					    		                    	$("#css3").css("background","#DDDDDD");
					    		                    	var obj=document.getElementById('datetype3');
					    		                        obj.options.length=0;//移除options 
					    		                		$.ajax({
					    		                			headers    : {
					    		                				"token" : localStorage.getItem("token")
					    		                			},
					    		                			url : APIHost + '/repairInformation/getDates',
					    		                			type : 'POST',
					    		                			async : false, //或false,是否异步
					    		                			timeout : 5000,
					    		                			dataType : 'json',
					    		                			contentType: "application/json; charset=utf-8",
					    		                			success : function(res) {
					    		                				$('#datetype3').append("<option hidden='hidden' value=''></option>");
					    		                				for(i in res){
					    		                    				$('#datetype3').append("<option value="+i+">"+res[i]+"</option>");
					    		                				}
					    		                				$('#datetype3').append("<option  value='e'>自定义</option>");
					    		                			},
					    		                			error : function() {
					    		                				console.log("错误");
					    		                			}
					    		                		});
					    		                    }  
					    		                 } 
					    		            }  
					    		        },
					    		        color: ['#3398DB'],
					    		        tooltip : {
					      			        trigger: 'axis',
					      			        axisPointer : {            // 坐标轴指示器，坐标轴触发有效
					      			            type : ''        // 默认为直线，可选为：'line' | 'shadow'
					      			        }
					      			    },
									xAxis : {
										type : 'category',
										name : '(天)',
										data : [ '0-1', '1-7', '7-15',
												'15-30', '30-60', '60-90',
												'90以上']
									},
									yAxis : {
										type : 'value',
										name : '报修工单数(条)',
										nameLocation: 'center',
										nameGap : '25',
										nameTextStyle : {
											fontSize : 17,
											fontWeight : 'bold'
										},
									},
									series : [ {
										data : [ monday, tuesday, Wednesday,
												thursday, friday, saturday,
												sunday ],
										type : 'bar',
										name:'数据信息'
									} ]
								};
								var myChart2 = echarts.init(document
										.getElementById('box3'));
								myChart2.setOption(option2);
								
							//})
				},
				error : function() {
					console.log("错误");
				}
			});

		}
		function find2(id) {
			if (id == 'e') {
				$("#startTime2").val("");
				$("#endTime2").val("");
				$("#searchForm3").show();
				$("#btnSubmitLog3").show();
			} else {
				$("#searchForm3").hide();
				$("#btnSubmitLog3").hide();
				fresh2(id);
			}
		}
	</script>
</body>
</html>