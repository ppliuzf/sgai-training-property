<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="renderer" content="webkit">
<meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10">
<meta http-equiv="Expires" content="0">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Cache-Control" content="no-store">
<script src="../static/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
<link href="../static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css" type="text/css" rel="stylesheet">
<link href="../static/bootstrap/2.3.1/awesome/font-awesome.min.css" type="text/css" rel="stylesheet">
<link href="../static/bootstrap/2.3.1/awesome/font-awesome.min.css" type="text/css" rel="stylesheet">

<!--分页  -->	
<script src="../static/paginator/bootstrap-paginator.js" type="text/javascript"></script>
<!-- 公共样式表	，公共方法 -->
<link href="../static/media/css/my-style.css" rel="stylesheet" type="text/css"/>
<script src="../static/media/js/main.js" type="text/javascript"></script>

<!-- <link href="../static/jquery-select2/4.0/select2.min.css" rel="stylesheet"> -->
<link href="../static/jquery-validation/1.11.0/jquery.validate.min.css" type="text/css" rel="stylesheet">
<link href="../static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css" rel="stylesheet">
<link href="../static/My97DatePicker/skin/WdatePicker.css" rel="stylesheet" type="text/css">
<link href="../static/common/smart.min.css" type="text/css" rel="stylesheet">
<script src="../static/bootstrap/2.3.1/js/bootstrap.min.js" type="text/javascript"></script>
<!-- <script src="../static/jquery-select2/4.0/select2.min.js" type="text/javascript"></script> -->
<script src="../static/jquery-validation/1.11.0/jquery.validate.min.js" type="text/javascript"></script>
<script src="../static/jquery-jbox/2.3/jquery.jBox-2.3.src.js" type="text/javascript"></script>
<script src="../static/My97DatePicker/WdatePicker.js" type="text/javascript"></script>
<script src="../static/common/mustache.min.js" type="text/javascript"></script>
<script src="../static/common/smart.min.js" type="text/javascript"></script>
<script src="../../config/smart-common.js" type="text/javascript"></script>
<script src="../static/wy/area.js" type="text/javascript"></script>
<style type="text/css">
	.detail-close{
		display: none;
	}
	.row-details{
		cursor:pointer;
	}
	.form-row{
		padding-left:15px;
	}
	.repair-size{
		margin-left: 20px;
	}
	.content-size{
		margin-left: 15px;
	}
	.operate_size {
	    width: 50px;
	}
	li{list-style:none;}
        .details {
            overflow: hidden;
            width: 50%;
            padding-left: 167px;
            margin-top: 7px;
        }
        .details>span:nth-child(1) {
        	color:#555555;
        	font-family : 微软雅黑;
            float: left;
        }
        .details>span:nth-child(2) {
       		padding-left: 6px;	
       		font-family : 宋体;
            float: left;
        }
        .table-striped tbody > tr:nth-child(4n+1) > td, .table-striped tbody > tr:nth-child(4n+1) > th {
		    background-color: #f5f5f5;
		}
		.table-striped tbody > tr:nth-child(4n+3) > td, .table-striped tbody > tr:nth-child(4n+3) > th {
		    background-color: #ffffff  !important;
		}
</style>
</head>
<body>
<div class="table_fluid">
	<div class="table_infor">
		<div class="table_title">
				<i class="icon-table"></i><span>事件验收</span>
		</div>
	</div>
    <form class="breadcrumb form-search" style="margin-top: 20px;" action="">
    	<ul class="ul-form">
    	<li><label>订单号：</label><input type="text" class="input-medium" id="orderNumber" name="orderNumber" /></li>
    	<li><label>报修人：</label><input type="text" class="input-small" id="repairPeopleName" name="repairPeopleName" /></li>
    	<li><label>维修状态：</label>
    		<select id="repairStatus" class="input-medium" name="repairStatus" tabindex="-1">
	            	<option value=""></option>
	            	<option value="7">维修完成</option>
	            	<option value="8">功能验收合格</option>
	            	<option value="9">功能验收不合格</option>
	            	<option value="10">环境验收合格</option>
	            	<option value="11">环境验收不合格</option>
	            	<option value="13">已评价</option>
	            </select></li>
	          <li><label>  事件级别:</label>
    			<select id="incidentRank" class="input-small" name="incidentRank" tabindex="-1">
	            	<option value=""></option>
	            	<option value="紧急">紧急</option>
	            	<option value="一般">一般</option>
	            </select></li>
    	<li><label>报修区域：</label><select id="repairAddress1" class="input-small" name="repairAddress1" tabindex="-1">
    				<option value=""></option>
    			</select>
    			<select id="repairAddress2" class="input-small" name="repairAddress2" tabindex="-1">
    				<option value=""></option>
    			</select>
    			<select id="repairAddress3" class="input-small" name="repairAddress3" tabindex="-1">
    				<option value=""></option>
    			</select>
    			</li>
    			<li><input type="hidden" id="repairAddress" name="repairAddress" /></li>
    	
	            <li><button type="button" onclick="pageload()" class="btn btn-primary btn_middle small_blue">查询</button></li>
	           <li> <button type="button" onclick="emptys()" class="btn btn-primary btn_middle small_blue">清空</button></li>
    		</ul>
    </form>
    
    <table id="privilegeTable" class="table table-striped table-bordered table-condensed">
    	<thead>
	    	<tr>
	    		<th></th>
	    		<!-- <th>进度</th> -->
	    		<th>订单号</th>
	    		<th>报修人</th>
	    		<th>预约时间</th>
	    		<th>报修区域</th>
	    		<th>事件级别</th>
	    		<th>类别</th>
	    		<th>状态</th>
	    		<th>操作</th>
	    	</tr>
    	</thead>
    	<tbody>
		</tbody>
    </table>
<div id="myModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		 <div class="modal-header">
		    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		    <h4 id="myModalLabel">验收</h4>
		 </div>
		<div class="modal-body">
	  		<iframe id="Iframe"></iframe>
	    </div>
</div>
<div id="myAppraise" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		 <div class="modal-header">
		    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		    <h4 id="myModalLabel">评价</h4>
		 </div>
		<div class="modal-body">
	  		<iframe id="aIframe"></iframe>
	    </div>
	</div>
<div id="showDate" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		 <div class="modal-header">
		    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
		    <h4 id="myModalLabel">请填写到场时间</h4>
		 </div>
		<div class="modal-body">
	  		<iframe id="sIframe"></iframe>
	    </div>
</div>
</div>


<script type="text/javascript">
	$(function(){  
		pageRightContent();
		pageload();  
	});  
	
	function pageload(n, s){
		//判断是否传pageSize
		var pageSize = $('.page-size option:selected').val();
		if(!$.isNumeric(s)){
			s = pageSize;
		} 
		//删除旧tbody
		var contentTableSub = document.getElementById("privilegeTable");
		var oldTbody = document.getElementById("privilegeTbody");
		if (oldTbody != null) {
			contentTableSub.removeChild(oldTbody);
		} 
		$.ajax({
			headers    : {
	            "token" : localStorage.getItem("token")
	        },
			url : APIHost + "/repairInformation/getCheckLists",
			type : 'Post',
			async : false, //或false,是否异步
			data : {
				pageNo : n,
				pageSize : s,
				orderNumber : $("#orderNumber").val(),
				repairPeopleName : $("#repairPeopleName").val(),
				repairStatus : $("#repairStatus").val(),
				repairAddress : $("#repairAddress").val(),
				incidentRank : $("#incidentRank").val() 
			},
			success:function (obj){
				//向页面拼接分页内容
				pageContent(obj.data);
				var newTbody = document.createElement("tbody");
				newTbody.setAttribute("id", "privilegeTbody");
				var goodBo = obj.data.list;
				for(var i = 0;i<goodBo.length;i++){
					var goods = goodBo[i];
					var tr = document.createElement("tr");
					
					var td12=document.createElement("td");
					td12.innerHTML = "<span itemId='"+goods.id+"' class='row-details'>+</span>";
					td12.className="operate_size";
					tr.appendChild(td12);
					
					/* var td11=document.createElement("td");
					td11.className="";
					tr.appendChild(td11); */
					
					var td1 = document.createElement("td");
					td1.innerHTML = goods.orderNumber;
					tr.appendChild(td1);
					
					var td2 = document.createElement("td");
					td2.innerHTML = goods.repairPeopleName;
					tr.appendChild(td2);
					
					var td3 = document.createElement("td");
					td3.innerHTML = goods.appointmentTime;
					tr.appendChild(td3);
					
					var td4 = document.createElement("td");
					td4.innerHTML = goods.repairDetailAddress;
					tr.appendChild(td4);
					
					var td5 = document.createElement("td");
					td5.innerHTML = goods.incidentRank;
					tr.appendChild(td5);
					
					var td6 = document.createElement("td");
					td6.innerHTML = goods.repairType;
					tr.appendChild(td6);
					
					var td7 = document.createElement("td");
					if(goods.repairStatus == '7'){
						td7.innerHTML ="维修完成" ;
					}else if(goods.repairStatus == '4'){
						td7.innerHTML ="已指派" ;
					}else if(goods.repairStatus == '8'){
						td7.innerHTML ="功能验收合格" ;
					}else if(goods.repairStatus == '9'){
						td7.innerHTML = "功能验收不合格";
					}else if(goods.repairStatus == '10'){
						td7.innerHTML = "环境验收合格";
					}else if(goods.repairStatus == '11'){
						td7.innerHTML ="环境验收不合格" ;
					}else if(goods.repairStatus == '13'){
						td7.innerHTML ="已评价" ;
					}else if(goods.repairStatus == '1'){
						td7.innerHTML ="已提交" ;
					}else if(goods.repairStatus == '3'){
						td7.innerHTML ="已受理" ;
					}else if(goods.repairStatus == '5'){
						td7.innerHTML ="维修开始" ;
					}else if(goods.repairStatus == '6'){
						td7.innerHTML ="等待中" ;
					}else if(goods.repairStatus == '17'){
						td7.innerHTML ="退单未指派" ;
					}else if(goods.repairStatus == '16'){
						td7.innerHTML ="已关闭" ;
					}else if(goods.repairStatus == '14'){
						td7.innerHTML ="已取消" ;
					}else if(goods.repairStatus == '12'){
						td7.innerHTML ="已验收" ;
					}else if(goods.repairStatus == '2'){
						td7.innerHTML ="已修改" ;
					}
					tr.appendChild(td7);
					
					//操纵
					var td8=document.createElement("td");
					if(goods.repairStatus == '7'){
						td8.innerHTML = maintainFinishStatus(goods);
					}else if(goods.repairStatus == '4'&&goods.incidentRank == '紧急'){
						td8.innerHTML = maintainShowUpDate(goods);
					}else if(goods.repairStatus == '8'){
						td8.innerHTML = fcheckQualified(goods);
					}else if(goods.repairStatus == '9'){
						td8.innerHTML = fcheckNoQualified(goods);
					}else if(goods.repairStatus == '10'){
						td8.innerHTML = echeckQualified(goods);
					}else if(goods.repairStatus == '11'){
						td8.innerHTML = echeckNoQualified(goods);
					}else if(goods.repairStatus == '13'){
						td8.innerHTML = appraiseStatus(goods);
					}
					td8.className="operate_size";
					tr.appendChild(td8);
					newTbody.appendChild(tr);
					showTrColor(goods,tr);
					var tr2 = document.createElement("tr");
					var td9=document.createElement("td");
					tr2.id = goods.id;
					td9.colSpan = "10";
					td9.style.padding = "0";
					td9.style.border = "0";
					td9.innerHTML = detailRepair(goods,tr);
					td9.className="";
					tr2.appendChild(td9);
					newTbody.appendChild(tr2);
					tr2.style.display = 'none';
					
				}
				
				contentTableSub.appendChild(newTbody);
				//table下每一行tr选中高亮
				inputCheck();
				//调用操作按钮方法
				handelBtn();
				//内容自适应iframe高度
			    setIframeHeight(parent.document.getElementById('mainFrame'));
			}
		})
	}
	
	function emptys(){
		$("input[type='text']").val("");
		$("#repairStatus option:first").prop("selected", 'selected');
		$("#incidentRank option:first").prop("selected", 'selected');
		$("#repairAddress1 option:first").prop("selected", 'selected');  
		$("#repairAddress2 option:first").prop("selected", 'selected');  
		$("#repairAddress3 option:first").prop("selected", 'selected');  
		$("#repairAddress").val("");
	}
	
	function deleteGoods(i){
		var id = $(i).attr("itemId");
		$.jBox.confirm("确定删除吗?", "提示", function (v, h, f) {
			if(v == 'ok'){
				deletebatchProcess(id);
			}
		})
	}
	
	function deletebatchProcess(ids){
		$.ajax({
			headers    : {
               "token" : localStorage.getItem("token"),
           },
			url : APIHost + '/repairInformation/delete',
			type : 'POST',
			async : false, //或false,是否异步
			data : {
				"ids":ids
			},
			timeout : 5000,
			dataType : 'json',
			success : function(res) {
				if(res.code === 1000){
					pageload();
				}else if(res.code === 1001){
					$.jBox.alert(res.msg,"提示");
					pageload();
				}else if(res.code ===1003){
					//没有登录状态
					$.jBox.alert('您没有登录状态，请先登录', '提示',{ closed: function ()
						{ window.parent.location.href= APIHost + "/sys/sysLogin.html"; } });
				}else if(res.code === 1002){
					//发生异常
					$.jBox.alert(res.msg,"提示");
				}else if(res.code === 1004){
					//结果为空
					$.jBox.alert(res.msg,"提示");
				}
			},
			error : function() {
				$.jBox.alert("系统错误，请重试","提示");
				console.log('错误');
			}
		})
	}

	
		var flag = true;
		$(".row-details").live("click",function(){
			var self = $(this);
			var paramId = $(this).attr("itemId");
			var tr2 = document.getElementById(paramId);
			if(tr2.style.display = 'none'){//如果当前隐藏 
				if(flag){
					$(this).text("-");
					tr2.style.display='';//那么就显示 
					flag = false;
				}else{
					$(this).text("+");
					tr2.style.display = 'none'//就隐藏
					flag = true;
				}
	    		
	        }
		});
		
		//维修完成
		function maintainFinishStatus(goods){
			var html = '<div class="btn-hover" style="display:inline-block;position:relative;">'
				+'<button type="button" class="btn btn-primary 	btn_medium small_blue btn_more">查看更多'
 				+' <span class="caret"></span></button>'
			+'<div class="btn_list pub-hide">'
				+'<button itemId='+goods.id+' onclick="fappointQualified(this)"  type="button" class="btn sg_middle handel_btn">'
				+'<i class="icon-edit icon_right icon-blue"></i>功能验收合格</button>'
				+'<button itemId='+goods.id+' onclick="fappointNoQualified(this)"  type="button" class="btn sg_middle handel_btn">'
				+'<i class="icon-edit icon_right icon-blue"></i>功能验收不合格</button>'
			+'</div>'
	        +'</div>';
	        return html;
		}
		//已指派&&紧急
		function maintainShowUpDate(goods){
			var html = '<div class="btn-hover" style="display:inline-block;position:relative;">'
				+'<button type="button" class="btn btn-primary 	btn_medium small_blue btn_more">查看更多'
 				+' <span class="caret"></span></button>'
			+'<div class="btn_list pub-hide">'
				+'<button itemId='+goods.id+' onclick="maintainShowDate(this)"  type="button" class="btn sg_middle handel_btn">'
				+'<i class="icon-edit icon_right icon-blue"></i>指定到场时间</button>'
			+'</div>'
	        +'</div>';
	        return html;
		}
		//功能验收合格
		function fcheckQualified(goods){
			var html = '<div class="btn-hover" style="display:inline-block;position:relative;">'
				+'<button type="button" class="btn btn-primary 	btn_medium small_blue btn_more">查看更多'
 				+' <span class="caret"></span></button>'
			+'<div class="btn_list pub-hide">'
				+'<button itemId='+goods.id+' onclick="eappointQualified(this)"  type="button" class="btn sg_middle handel_btn">'
				+'<i class="icon-edit icon_right icon-blue"></i>环境验收合格</button>'
				+'<button itemId='+goods.id+' onclick="enAppointNoQualified(this)"  type="button" class="btn sg_middle handel_btn">'
				+'<i class="icon-edit icon_right icon-blue"></i>环境验收不合格</button>'
			+'</div>'
	        +'</div>';
	        return html;
		}
		//功能验收不合格
		function fcheckNoQualified(goods){
			var html = '<div class="btn-hover" style="display:inline-block;position:relative;">'
				+'<button type="button" class="btn btn-primary 	btn_medium small_blue btn_more">查看更多'
 				+' <span class="caret"></span></button>'
			+'<div class="btn_list pub-hide">'
				+'<button itemId='+goods.id+' onclick="fappointQualified(this)"  type="button" class="btn sg_middle handel_btn">'
				+'<i class="icon-edit icon_right icon-blue"></i>功能验收合格</button>'
			+'</div>'
	        +'</div>';
	        return html;
		}
		//环境验收合格
		function echeckQualified(goods){
			var html = '<div class="btn-hover" style="display:inline-block;position:relative;">'
				+'<button type="button" class="btn btn-primary 	btn_medium small_blue btn_more">查看更多'
 				+' <span class="caret"></span></button>'
			+'<div class="btn_list pub-hide">'
				+'<button itemId='+goods.id+' onclick="appraise(this)"  type="button" class="btn sg_middle handel_btn">'
				+'<i class="icon-edit icon_right icon-blue"></i>评价</button>'
			+'</div>'
	        +'</div>';
	        return html;
		}
		//环境验收不合格
		function echeckNoQualified(goods){
			var html = '<div class="btn-hover" style="display:inline-block;position:relative;">'
				+'<button type="button" class="btn btn-primary 	btn_medium small_blue btn_more">查看更多'
 				+' <span class="caret"></span></button>'
			+'<div class="btn_list pub-hide">'
				+'<button itemId='+goods.id+' onclick="eappointQualified(this)"  type="button" class="btn sg_middle handel_btn">'
				+'<i class="icon-edit icon_right icon-blue"></i>环境验收合格</button>'
			+'</div>'
	        +'</div>';
	        return html;
		}
		//已验收
		function checkStatus(goods){
			var html = '<div class="btn-hover" style="display:inline-block;position:relative;">'
				+'<button type="button" class="btn btn-primary 	btn_medium small_blue btn_more">查看更多'
 				+' <span class="caret"></span></button>'
			+'<div class="btn_list pub-hide">'
				+'<button itemId='+goods.id+' onclick="appraise(this)"  type="button" class="btn sg_middle handel_btn">'
				+'<i class="icon-edit icon_right icon-blue"></i>评价</button>'
			+'</div>'
	        +'</div>';
	        return html;
		}
		//已评价
		function appraiseStatus(goods){
			var html ="<span>已完成评价</span>";
	        return html;
		}
		
		
		function detailRepair(goods,tr){
			//修改tr颜色
		//	showTrColor(goods,tr);
			var html = "<table id='repair-detail' style='width:100%;'>"
				+"<tr>"
				+"<td style='text-align:left;width:50%;height:300px;background:#e3e3e3;'>"
					+"<div style='float: left; display: block;'>"
						+"<div class='form-row'>"
							+"<div style='display:inline-block;vertical-align:middle;width:200px;'><span class='repair-size'><b>订单号:</b></span><span class='content-size'>"+goods.orderNumber+"</span></div>"
							+"<div style='display:inline-block;vertical-align:middle;'><span class='repair-size'><b>报修人:</b></span><span class='content-size'>"+goods.repairPeopleName+"</span></div>"
						+"</div><br/>"
						+"<div class='form-row'>"
							+"<div style='display:inline-block;vertical-align:middle;width:200px;'><span class='repair-size'><b>联系电话:</b></span><span class='content-size'>"+goods.repairPhone+"</span></div>"	
							+"<div style='display:inline-block;vertical-align:middle;'><span class='repair-size'><b>事件级别:</b></span><span class='content-size'>"+(goods.incidentRank == '一般'? goods.incidentRank:(goods.incidentRank+"--"+goods.emergenciesType))+"</span></div>"	
						+"</div><br/>"
						+"<div class='form-row'>"
							+"<div style='display:inline-block;vertical-align:middle;width:200px;'><span class='repair-size'><b>事件来源:</b></span><span class='content-size'>"+getIncidentSource(goods.incidentSource)+"</span></div>"
							+"<div style='display:inline-block;vertical-align:middle;'><span class='repair-size'><b>报修类型:</b></span><span class='content-size'>"+goods.repairType+"</span></div>"
						+"</div><br/>"
						+"<div class='form-row'>"
							+"<div style='display:inline-block;vertical-align:middle;width:200px;'><span class='repair-size'><b>受理人员:</b></span><span class='content-size'>"+(goods.acceptPerson == null?"未指定":goods.acceptPerson)+"</span></div>"
							+"<div style='display:inline-block;vertical-align:middle;'><span class='repair-size'><b>维修人员:</b></span><span class='content-size'>"+(goods.maintainPerson == null?"未指定":goods.maintainPerson)+"</span></div>"
						+"</div><br/>"
						+"<div class='form-row'>"
							+"<div style='display:inline-block;vertical-align:middle;width:200px;'><span class='repair-size'><b>维修人电话:</b></span><span class='content-size'>"+(goods.maintainPersonTelepno == 'null'||goods.maintainPersonTelepno == null?"无":goods.maintainPersonTelepno)+"</span></div>"
							+"<div style='display:inline-block;vertical-align:middle;'><span class='repair-size'><b>到场时间:</b></span><span class='content-size'>"+(goods.maintainShowUpDate == null?"未指定":goods.maintainShowUpDate)+"</span></div>"	
						+"</div><br/>"
						+"<div class='form-row'>"
							+"<span class='repair-size'><b>预约时间:</b></span><span class='content-size'>"+goods.appointmentTime+"--"+goods.appointmentTimeGo+"</span>"	
						+"</div><br/>"
						+"<div class='form-row'>"
							+"<span class='repair-size'><b>报修地址:</b></span><span class='content-size'>"+(goods.repairAddress+"-"+goods.detailAddress)+"</span>"	
						+"</div><br/>"
						+"<div class='form-row'>"
						+"<span class='repair-size'><b>计划维修时间:</b></span>"
						+"<span class='content-size'>"+(goods.planMaintainDate == null?"未指定":goods.planMaintainDate)+"</span>"
					+"</div><br/>"
						+"<div class='form-row'>"
							+"<span class='repair-size'><b>故障描述:</b></span>"
							+"<span class='content-size'>"+goods.faultDescription+"</span>"
						+"</div><br/>"
					+"</div></br/>"
					+"<div class='img-box' style='display:none;position:relative;height:287px;'>"
						+"<div class='img_content'></div>"
						+"<i class='icon-chevron-left left_ward'></i>"
						+"<i class='icon-chevron-right right_ward'></i>"
						+"<i class='icon-remove remove-sty'></i>"
					+"</div>"
				+"</td>"
				+"<td style='background:#dadada;width:9%;'>"
					+"<div class='img-small'>显示图片</div>"
				+"</td>"
				+"<td style='padding-left:30px;width:41%;background:#e3e3e3;'>"
					+"<table>"
						+"<tbody class='order-track'>"
							if(goods.repairRecords != null){
								var recordList = goods.repairRecords;
								for(var j = 0;j < recordList.length;j++){
									html += "<tr>"
										+"<td style='width:40px;position:relative;background:#e3e3e3;'>"
											+"<span class='ring-sty' style='position: relative; z-index: 101; border: 3px solid rgb(0, 102, 204);'>"
											+"</span>"
										+"</td>"
										+"<td style='background:#e3e3e3;text-align:left;'>"
							        		+"<span class='ring-detail'>"+recordList[j].repairLog+"</span>"
							      		+"</td>"
							      		+"<td style='width:160px;background:#e3e3e3;text-align:left;'>"
											+"<span class='ring-time'>"+recordList[j].presentDate+"</span>"
										+"</td>"
									+"</tr>"
								}
							}
						+"</tbody>"
					+"</table>"
				+"</td>"
			+"</tr>"
	+"</table>";
	return html;
	}
		
	function maintainShowDate(index){
		var id = $(index).attr("itemId");
		var url = APIHost + "/wy/repairInformation/repair_showup_date.html?repairId="+id;
		$('#showDate').modal('show');
    	$("#sIframe").attr("src",url);
    	$("#sIframe").css("height","200px"); 
	}
		
	//功能验收合格
	function fappointQualified(index){
		var id = $(index).attr("itemId");
		var repairStatus = "8";
		$.jBox.confirm("确定功能验收合格吗?", "提示", function (v, h, f) {
			if(v == 'ok'){
				upRepairStatus(id,repairStatus);
			}
		})
	}
	//环境验收合格
	function eappointQualified(index){
		var id = $(index).attr("itemId");
		var repairStatus = "10";
		$.jBox.confirm("确定环境验收合格吗?", "提示", function (v, h, f) {
			if(v == 'ok'){
				upRepairStatus(id,repairStatus);
			}
		})
	}
	function upRepairStatus(id,repairStatus){
		$.ajax({
			headers    : {
	            "token" : localStorage.getItem("token")
	        },
	        async : "false",
			url : APIHost + "/repairInformation/upRepairStatus",
			type : 'Post',
			async : false, //或false,是否异步
			data : {
				id : id,
				repairStatus : repairStatus
			},
			success:function (obj){
				if(obj.code === 1000){
					pageload();
				}
			}
		});
	}
	//功能验收不合格
	function fappointNoQualified(index){
		var id = $(index).attr("itemId");
		var url = APIHost + "/wy/repairInformation/repair_check_cause.html?repairId="+id+"&flag=1";
		$('#myModal').modal('show');
    	$("#Iframe").attr("src",url);
    	$("#Iframe").css("height","200px"); 
	}
	//环境验收不合格
	function enAppointNoQualified(index){
		var id = $(index).attr("itemId");
		var url = APIHost + "/wy/repairInformation/repair_en_check_cause.html?repairId="+id;
		$('#myModal').modal('show');
    	$("#Iframe").attr("src",url);
    	$("#Iframe").css("height","220px"); 
	}
	//评价
	function appraise(index){
		var id = $(index).attr("itemId");
		var url = APIHost + "/wy/repairInformation/repair_appraise.html?repairId="+id;
		$('#myAppraise').modal('show');
    	$("#aIframe").attr("src",url);
    	$("#aIframe").css("height","200px"); 
	}
	
	function getIncidentSource(incidentSource){
		if("1" == incidentSource){
			return "pc端提报";
		}else if("2" == incidentSource){
			return "app端提报";
		}else if("3" == incidentSource){
			return "检修转事件";
		}
	}
	Date.prototype.diff = function(date){
		  return (this.getTime() - date.getTime())/(24 * 60 * 60 * 1000);
	} 
	//tr显示颜色
	function showTrColor(goods,tr){
		//debugger;
		var submitDate;
		var recordList = goods.repairRecords;
		for(var h = 0;h < recordList.length;h++){
			if(recordList[h].repairStatus == "1"){
				submitDate = recordList[h].presentDate;
			}
		}
		var now = new Date();
		var date = new Date(submitDate);
		var diff = now.diff(date);
		if(diff <= 7){
			if(goods.repairStatus != "10"||goods.repairStatus != "13"){
				//tr.style.background = "#F43816";
				tr.style.background = "red";
			}
		}else if(diff > 7&&diff <= 14){
			if(goods.repairStatus != "10"||goods.repairStatus != "13"){
				tr.style.background = "#3E8EF6";
			}
		}else if(diff>14){
			if(goods.repairStatus != "10"||goods.repairStatus != "13"){
				tr.style.background = "#B431F3";
			}
		}
	} 
</script>
  </body>
</html>