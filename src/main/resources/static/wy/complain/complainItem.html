<html>
<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10">
    <meta http-equiv="Expires" content="0">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-store">
    <script src="../static/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
    <link href="../static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css" type="text/css" rel="stylesheet">
    <link href="../static/bootstrap/2.3.1/awesome/font-awesome.min.css" type="text/css" rel="stylesheet">
    <!--分页  -->
    <script src="../static/jquery/jquery-1.8.3.min.js" type="text/javascript"></script>
    <link href="../static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css" type="text/css" rel="stylesheet">
    <script src="../static/bootstrap/2.3.1/js/bootstrap.min.js" type="text/javascript"></script>
    <link href="../static/bootstrap/2.3.1/awesome/font-awesome.min.css" type="text/css" rel="stylesheet">
    <!--[if lte IE 7]>
    <link href="../static/bootstrap/2.3.1/awesome/font-awesome-ie7.min.css" type="text/css" rel="stylesheet"/>
    <![endif]-->
    <!--[if lte IE 6]>
    <script src="../static/bootstrap/bsie/js/bootstrap-ie.min.js" type="text/javascript"></script><![endif]-->
    <link href="../static/jquery-validation/1.11.0/jquery.validate.min.css" type="text/css" rel="stylesheet">
    <script src="../static/jquery-validation/1.11.0/jquery.validate.min.js" type="text/javascript"></script>
    <link href="../static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css" rel="stylesheet">
    <script src="../static/jquery-jbox/2.3/jquery.jBox-2.3.min.js" type="text/javascript"></script>
    <script src="../static/My97DatePicker/WdatePicker.js" type="text/javascript"></script>
    <link href="../static/My97DatePicker/skin/WdatePicker.css" rel="stylesheet" type="text/css">
    <script src="../static/common/mustache.min.js" type="text/javascript"></script>
    <link href="../static/common/smart.min.css" type="text/css" rel="stylesheet">
    <script src="../static/common/smart.min.js" type="text/javascript"></script>
    <script src="../static/jquery-form/3.51.0/jquery.form.js" type="text/javascript"></script>
    <link href="../static/media/css/my-style.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript">var ctx = '/admin', ctxStatic = '../../static';</script>
    <script src="../../config/smart-common.js" type="text/javascript"></script>
    <script src="../static/common/commonMethod.js"></script>

    <script type="text/javascript">
        var ctx = '/admin', ctxStatic = '../../static';
    </script>
    <title>投诉</title>
    <meta name="decorator" content="default">
    <style>
        .con {
            margin-left: 0;
            text-align: left !important;
        }

        #ul1 > li > label:first-child {
            width: 90px !important;
        }

        #ul1 > li {
            width: 250px;
            list-style: none;
        }

        input, select {
            width: 150px;
        }

        .repair-size {
            margin-left: 20px;
            font-weight: bold;
            font-size:small;
        }

        .content-size {
            margin-left: 15px;
            font-size:small;
            font-family :  宋体;
        }
    </style>
</head>
<body >
<!--<div class="breadcrumb form-search">
    <ul id="ul1" class="ul-form">
        <li>
            <label>订单号：</label>
            <label class="con" name="orderNumber"></label>
        </li>
        <li>
            <label>故障来源：</label>
            <label class="con" name="cause"></label>
        </li>
        <li>
            <label>报修人：</label>
            <label class="con" name="repairPeopleName"></label>
        </li>
        <li>
            <label>联系电话：</label>
            <label class="con" name="repairPhone"></label>
        </li>
        <li>
            <label>报修类型：</label>
            <label class="con" name="repairType"></label>
        </li>
        <li>
            <label>受理人员：</label>
            <label class="con" name="acceptPerson"></label>
        </li>
        &lt;!&ndash;<li>
            <label>故障类型：</label>
            <label class="con" name="" style="color: red">字段缺失</label>
        </li>&ndash;&gt;
        <li>
            <label>耗材费用：</label>
            <label class="con" name="consumableMoney"></label>
        </li>
        <li>
            <label>维修费用：</label>
            <label class="con" name="维修费用"></label>
        </li>
        <li>
            <label>维护人员：</label>
            <label class="con" name="maintainPerson"></label>
        </li>
        &lt;!&ndash;<li>
            <label>维护人电话：</label>
            <label class="con" name="" style="color: red">字段缺失</label>
        </li>&ndash;&gt;
    </ul>
    <div>
        <label>预约时间：</label>
        <label class="con" name="appointmentTime"></label>
    </div>
    <div>
        <label>报修地址：</label>
        <label class="con" name="repairDetailAddress"></label>
    </div>
    <div>
        <label>故障描述：</label>
        <label class="con" name="faultDescription"></label>
    </div>
</div>-->
<div id="events"></div>
<div  style="margin-top:-30px">
    <form id="searchForm" class="breadcrumb form-search " method="post">
        <input name="sourceKey" type="hidden" id="sourceKey"/>
        <input name="sourceNum" type="hidden" id="sourceNum"/>
        <ul class="ul-form" >
            <li><label>姓名：</label><input class="query_input" type="text" id="complainerName" name="complainerName"
                                         maxlength="50"/></li>
            <li><label>联系电话：</label><input class="query_input" type="text" id="complainerPhone" name="complainerPhone"
                                           maxlength="50"/></li>
            <li><label>标题：</label><input class="query_input" type="text" id="complainTitle" name="complainTitle"
                                         maxlength="50"  style="width: 389px !important;"/></li>
            <li class="clearfix">  </li>
        </ul>
        <div style="margin-left:40px;margin-top:3px;">
              <label >内容：</label>
            <textarea rows="3" id="complainContent" name="complainContent" style="margin-left:-6px;width: 390px;resize:none">
            </textarea>
        </div>

    </form>
    <div class="form-actions" style="margin-top:-30px">
        <input id="btnSubmit" class="btn btn-primary" type="submit" value="提  交" onclick="formSubmit()">&nbsp;
        <input id="btnCancel" class="btn " type="button" value="取  消" onclick="back()">
    </div>
</div>
<script type="text/javascript">
    var itemId = GetQueryString("itemId");
    $.ajax({
        headers: {
            "token": localStorage.getItem("token"),
        },
        url: APIHost + '/repairInformation/findRepairById',
        type: 'POST',
        async: false, //或false,是否异步
        data: {id: itemId},
        timeout: 5000,
        dataType: 'json',
        success: function (res) {
            if (res.code === 1000) {
                var data = res.data;
                $("#sourceNum").val(data.orderNumber);
                for (var k in data) {
                    $("[name=" + k + "]").html(data[k]);
                }
                var html = addTable(data);
                $("#events").html(html)
            } else if (res.code === 1003) {
                //没有登录状态
                $.jBox.alert('您没有登录状态，请先登录', '提示', {
                    closed: function () {
                        window.parent.location.href = APIHost + "/sys/sysLogin.html";
                    }
                });
            } else if (res.code === 1002) {
                //发生异常
                $.jBox.alert(res.msg);
            } else if (res.code === 1004) {
                //结果为空
                $.jBox.alert(res.msg);
            }
        },
        error: function () {
            console.log('错误')
        }
    })
    $(document).ready(function () {
        /*输入校验*/
        $("#searchForm").validate({
            rules: {},
            message: {}
        });

    });


    function formSubmit() {
        $("#sourceKey").val(itemId);
        var ajax_option = {
            headers: {
                "token": localStorage.getItem("token")
            },
            url: APIHost + '/admin/complain/save',//默认是form action
            success: function (response) {
                if (response.data.msg == "success") {
					parent.hideDiv();
                    parent.pageload();
					parent.jBox.alert("保存成功 !","提示");
                }
                else if (response.msg == "exists") {
                    $.jBox.alert("数据已存在", "提示");
                }
                else {
                    $.jBox.alert("错误", "提示");
                }
            },
            beforeSend:function(){
          		var loading=$('<div id="loading"></div>');
          		$('body').append(loading);
          		$("#btnSubmit").attr("disabled",true)
          	},
          	complete:function(){
            	$("#btnSubmit").attr("disabled",false);
            	$("#loading").hide();
            }
        }

        $("#searchForm").ajaxSubmit(ajax_option);
    }

    function back() {
        parent.location.reload();
    }

    function addTable(goods) {
        var html = "<table id='repair-detail' style='width:100%;'>"
            + "<tr>"
            + "<td style='text-align:left;width:50%;height:280px;background:#e3e3e3;'>"
            + "<div style='float: left; display: block;'>"
            + "<div class='form-row'>"
            + "<div style='display:inline-block;vertical-align:middle;width:255px;'><span class='repair-size'>订单号:</span><span class='content-size'>" + goods.orderNumber + "</span></div>"
            +"<div style='display:inline-block;vertical-align:middle;'><span class='repair-size'>报修人:</span><span class='content-size'>" + goods.repairPeopleName + "</span></div>"
            + "</div><br/>"

            + "<div class='form-row'>"
            + "<div style='display:inline-block;vertical-align:middle;width:255px;'><span class='repair-size'>联系电话:</span><span class='content-size'>" + goods.repairPhone + "</span></div>"
            +"<div style='display:inline-block;vertical-align:middle;'><span class='repair-size'>故障来源:</span><span class='content-size'>" + getIncidentSource(goods.incidentSource) + "</span></div>"
            + "</div><br/>"

            + "<div class='form-row'>"
            + "<div style='display:inline-block;vertical-align:middle;width:255px;'><span class='repair-size'>报修类型:</span><span class='content-size'>" + goods.repairType + "</span></div>"
            +"<div style='display:inline-block;vertical-align:middle;'><span class='repair-size'>事件级别:</span><span class='content-size'>" + goods.incidentRank + "</span></div>"
            + "</div><br/>"
            + "<div class='form-row'>"
            + "<div style='display:inline-block;vertical-align:middle;width:255px;'><span class='repair-size'>受理人员:</span><span class='content-size'>" + (goods.acceptPerson == null ? "未指定" : goods.acceptPerson) + "</span></div>"
            +"<div style='display:inline-block;vertical-align:middle;'><span class='repair-size'>维修人员:</span><span class='content-size'>" + (goods.maintainPerson == null ? "未指定" : goods.maintainPerson) + "</span></div>"
            + "</div><br/>"

            + "<div class='form-row'>"
            + "<span class='repair-size'>预约时间:</span><span class='content-size'>" + goods.appointmentTime + "--" + goods.appointmentTimeGo + "</span>"
            + "</div><br/>"


            + "<div class='form-row'>"
            + "<span class='repair-size'>报修地址:</span><span class='content-size'>" + (goods.repairAddress + "-" + goods.detailAddress) + "</span>"
            + "</div><br/>"
            + "<div class='form-row'>"
            + "<span class='repair-size'>故障描述：</span>"
            + "<span class='content-size'>" + goods.faultDescription + "</span>"
            + "</div><br/>"
            + "<div class='form-row'>"
            + "<span class='repair-size'>计划维修时间：</span>"
            + "<span class='content-size'>" + (goods.planMaintainDate == null ? "未指定" : goods.planMaintainDate) + "</span>"
            + "</div><br/>"
            + "</div></br/>"
            + "<div class='img-box' style='display:none;position:relative;height:287px;'>"
            + "<div class='img_content'></div>"
            + "<i class='icon-chevron-left left_ward'></i>"
            + "<i class='icon-chevron-right right_ward'></i>"
            + "<i class='icon-remove remove-sty'></i>"
            + "</div>"
            + "</td>"
            + "</tr>"
            + "</table>";
        return html
    }

    function getIncidentSource(incidentSource) {
        if ("1" == incidentSource) {
            return "pc端提报";
        } else if ("2" == incidentSource) {
            return "app端提报";
        } else if ("3" == incidentSource) {
            return "检修转事件";
        }
    }
</script>
</body>
</html>