<!DOCTYPE html>
<html>
<head>
<title>新增杂志/报刊信息</title>

<meta name="renderer" content="webkit">
<meta http-equiv="Expires" content="0">
<meta http-equiv="Cache-Control" content="no-cache">
<meta http-equiv="Cache-Control" content="no-store">
<meta http-equiv="X-UA-Compatible" content="IE=8,IE=9,IE=10">
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<script src="../static/jquery/jquery-1.8.3.min.js"
	type="text/javascript"></script>
<link
	href="../static/bootstrap/2.3.1/css_cerulean/bootstrap.min.css"
	type="text/css" rel="stylesheet">
<script src="../static/bootstrap/2.3.1/js/bootstrap.min.js"
	type="text/javascript"></script>
<link
	href="../static/bootstrap/2.3.1/awesome/font-awesome.min.css"
	type="text/css" rel="stylesheet">
<script src="../static/bootstrap/bsie/js/bootstrap-ie.min.js"
	type="text/javascript"></script>
<![endif]-->
<link
	href="../static/jquery-validation/1.11.0/jquery.validate.min.css"
	type="text/css" rel="stylesheet">
<script
	src="../static/jquery-validation/1.11.0/jquery.validate.min.js"
	type="text/javascript"></script>
<link
	href="../static/jquery-jbox/2.3/Skins/Bootstrap/jbox.min.css"
	rel="stylesheet">
<script src="../static/jquery-jbox/2.3/jquery.jBox-2.3.min.js"
	type="text/javascript"></script>
<script src="../static/My97DatePicker/WdatePicker.js"
	type="text/javascript"></script>
<link href="../static/My97DatePicker/skin/WdatePicker.css"
	rel="stylesheet" type="text/css">
<script src="../static/common/mustache.min.js"
	type="text/javascript"></script>
<link href="../static/common/smart.min.css" type="text/css"
	rel="stylesheet">
<script src="../static/common/smart.min.js"
	type="text/javascript"></script>
<script src="../static/jquery-form/3.51.0/jquery.form.js"
	type="text/javascript"></script>
<link href="../static/media/css/my-style.css" rel="stylesheet"
	type="text/css" />
<script type="text/javascript">
	var ctx = '/admin', ctxStatic = '../../static';
</script>
<script src="../../config/smart-common.js"
	type="text/javascript"></script>
<script src="../static/wy/area.js" type="text/javascript"></script>
<script type="text/javascript">
	$(function() {
		jQuery.ajax({
			headers : {
				"token" : localStorage.getItem("token")
			},
			url : APIHost + '/magazine/findAllM',
			type : "POST",
			dataType : 'json',
			data : {},
			success : function(data) {
				var items = data.data;
				$('#magazine').append(
						"<option hidden='hidden' value=''></option>");
				$('#magazine1').append(
						"<option hidden='hidden' value=''></option>");
				$('#magazine2').append(
						"<option hidden='hidden' value=''></option>");
				$('#magazine3').append(
						"<option hidden='hidden' value=''></option>");
				$('#magazine4').append(
						"<option hidden='hidden' value=''></option>");
				for (var i = 0; i < items.length; i++) {
					$('#magazine').append(
							"<option value="+items[i].magazineName+">"
									+ items[i].magazineName + "</option>");
					$('#magazine1').append(
							"<option value="+items[i].magazineName+">"
									+ items[i].magazineName + "</option>");
					$('#magazine2').append(
							"<option value="+items[i].magazineName+">"
									+ items[i].magazineName + "</option>");
					$('#magazine3').append(
							"<option value="+items[i].magazineName+">"
									+ items[i].magazineName + "</option>");
					$('#magazine4').append(
							"<option value="+items[i].magazineName+">"
									+ items[i].magazineName + "</option>");
				}
			}
		})
	});
	
	
</script>
<style >

  
  li{
   list-style:none;
  }
        .form-search label {
   			 margin-left: -4px;
			}
			
			        label.error {
		    background: url(../static/jquery-validation/1.11.0/images/unchecked.gif) no-repeat 85px 3px;
		    padding-left: 4px;
		    padding-bottom: 2px;
		    font-weight: bold;
		    color: #ea5200;
		    display: block;
		    margin-left: 10px;
		    width:160px !important;
		}
		.help-block, .help-inline {
		    color: #aaa;
		    position: absolute;
		    right: -10px;
		    top: 3px;
		}
		
		.form-search .ul-form li label {
			    width: 90px;
			    text-align: right;
			}

		.form-search .ul-form li {
		    float: left;
		    height: 35px;
		    line-height: 35px;
		    list-style: none;
		     position: relative;
		}
</style>
</head>
<body>
	<form id="inputForm" class="breadcrumb form-search form-horizontal"" method="post"
		novalidate="novalidate">
		<input id="id" name="id" type="hidden" value="" />
		<script type="text/javascript">
			top.$.jBox.closeTip();
		</script>
 <ul class="ul-form"   style="height: 158px;margin-top: -20px;">
 	<li>
            <label>日期:</label>
            <input id="signDate" class=" input-small required Wdate" name="signDate" style="width: 151px;"
                   onclick="WdatePicker({ dateFmt: 'yyyy-MM-dd HH:mm:ss' })" type="text" value="" maxlength="50">
            <span class="help-inline"><font color="red">*</font> </span>
        </li>
        <li>
            <label>签收人部门:</label>
            <select id="signDept" class=" input-small  required" name="signDept" style="width: 177px;">
                <option id="one" value="">请选择</option>
                <option value="秘书行政部">秘书行政部</option>
                <option value="新闻宣传部">新闻宣传部</option>
                <option value="财务部">财务部</option>
                <option value="监察审计部">监察审计部</option>
                <option value="人力资源部">人力资源部</option>
                <option value="总体策划部">总体策划部</option>
                <option value="张家口运行中心">张家口运行中心</option>
                <option value="规划建设和可持续发展部">规划建设和可持续发展部</option>
                <option value="延庆运行中心">延庆运行中心</option>
                <option value="法律事务部">法律事务部</option>
                <option value="体育部">体育部</option>
                <option value="运动会服务部">运动会服务部</option>
                <option value="对外联络部">对外联络部</option>
                <option value="市场开发部">市场开发部</option>
                <option value="技术部">技术部</option>
            </select>
            <span class="help-inline"><font color="red">*</font> </span>
        </li>
        <li>
        		<div class="control-group" style="margin-top: 16px;">
			<label class="control-label">区域:</label>
			<div class="controls"  style="margin-left: 1px;">
				<select id="repairAddress1" class="input-mini" name="repairAddress1"
					tabindex="-1"  style="margin-left: 4px;width: 166px;">
					<option value=""></option>
				</select> <select id="repairAddress2" class="input-mini"
					name="repairAddress2" tabindex="-1"  style="width: 135px;"></select> <select
					id="repairAddress3" class="input-mini  required" name="repairAddress3"
					tabindex="-1"   style="width: 120px;"></select> <input type="hidden" id="repairAddress"
					name="repairAddress" /> 
					<input type="hidden" id="repairAddressCode" name="repairAddressCode" />
					<span class="help-inline"><font
					color="red"></font> </span>
			</div>
		</div>
        
        </li>
        <li>	
        <div class="control-group"  style="margin-top: 36px;">
			<label class="control-label">备注:</label>
			<div class="controls" 	style="margin-left: 1px;">
				<textarea id="remarks" name="remarks" rows="2" cols="40"
					style="width: 416px;margin-left: 4px;height: 42px;resize:none"></textarea>
			</div>
		</div>
		</li>
 </ul>
		
		


	<div style="margin-top: 14px;">
		<ul class="ul-form"   style="height: 36px;">
		<input type="hidden" value="0" id="hidden0">
		<li>
				<label class="control-label"  style="width: 82px;margin-top: 2px;">报刊名称:</label>
				<select id="magazine" name="magazine" onchange="" style="width: 165px;margin-left: 12px;"></select>
				<span class="help-inline"><font color="red">*</font> </span>
		</li>
		<li>
				<label class="control-label">份数:</label>
				<input type=text id="phr" name="phrs" class="input-small"  style="width: 161px;margin-left: 4px;"/>
				<span class="help-inline"><font color="red">*</font> </span>
		</li>
		</ul>
		</div>
		<div style="display: none" id="hidden1">
		<ul class="ul-form"  >
			<li>
				<label class="control-label">报刊名称:</label>
					<select id="magazine1" name="magazine" onchange=""  style="width: 165px;margin-left: 4px;"></select>
					<span class="help-inline"><font color="red">*</font> </span>
				</li>
				<li>
				<label class="control-label">份数:</label>
					<input type=text id="phr1" name="phrs" class="small"  style="width: 161px;margin-left: 4px;"/>
					<span class="help-inline"><font color="red">*</font> </span>
				</li>
				</ul>
		
		</div>
		<div style="display: none" id="hidden2">
			<ul class="ul-form"  >
			<li>
				<label class="control-label">报刊名称:</label>
				<select id="magazine2" name="magazine" onchange=""  style="width: 165px;margin-left: 4px;"></select>
				<span class="help-inline"><font color="red">*</font> </span>
				</li>
			<li>
				<label class="control-label">份数:</label>
				<input type=text id="phr2" name="phrs" class="small"   style="width: 161px;margin-left: 4px;"/>
				<span class="help-inline"><font color="red">*</font> </span>
			</li>
			</ul>
		</div>
		<div style="display: none" id="hidden3">
		<ul class="ul-form"  >
			<ul class="ul-form"  >
			<li>
				<label class="control-label">报刊名称:</label>
				<select id="magazine3" name="magazine" onchange=""  style="width: 165px;margin-left: 4px;"></select>
				<span class="help-inline"><font color="red">*</font> </span>
				</li>
			<li>
				<label class="control-label">份数:</label>
				<input type=text id="phr3" name="phrs" class="small"   style="width: 161px;margin-left: 4px;"/>
				<span class="help-inline"><font color="red">*</font> </span>
			</li>
			</ul>
		</div>
		<div style="display: none" id="hidden4">
					<ul class="ul-form"  >
			<li>
				<label class="control-label">报刊名称:</label>
				<select id="magazine4" name="magazine" onchange=""  style="width: 165px;margin-left: 4px;"></select>
				<span class="help-inline"><font color="red">*</font> </span>
				</li>
			<li>
				<label class="control-label">份数:</label>
				<input type=text id="phr4" name="phrs" class="small"   style="width: 161px;margin-left: 4px;"/>
				<span class="help-inline"><font color="red">*</font> </span>
			</li>
			</ul>
		</div>
		<div class="small_btn" style="float: left;margin-top: 5px;">
			<label class="control-label"  style="width: 82px;">添加报纸:</label>
			<button id="btnInsert" class="btn btn-primary btn_icon small_blue"
				type="button" value="新增" onclick="add();">
				<i class="icon-plus"></i>
			</button>
			<button id="btnInsert" class="btn btn-primary btn_icon small_blue"
				type="button" value="新增" onclick="reduce();">
				<i class="icon-minus"></i>
			</button>
		</div>
		<div class="form-actions">
			<input id="btnSubmit" class="btn btn-primary" type="submit"
				value="保  存">&nbsp; <input id="btnCancel" class="btn "
				type="button" value="返  回" onclick="back()">
		</div>
	</form>

	<script type="text/javascript">
		// 设置表单验证,调用表单提交
		$.validator.setDefaults({
			submitHandler : function() {
				formSubmit();
			}
		});
		// 提交表单数据
		function formSubmit() {
	    	var i=$('#hidden0').val();
	    	var magazine=$('#magazine').val();
    	  	var r = /^\d+$/;　
    	  	var array=[];
    		array.push(magazine);
    		var phr=$('#phr').val();
    		if(!r.test(phr)){
    			parent.jBox.alert("请填写正确报纸份数(非负整数)", "提示");
    			return;
    		}
	    	for(var j=1;j<=i;j++){
	    		var magazine=$('#magazine'+j).val();
	    		if(magazine==''){
	    			parent.jBox.alert("页面信息不能为空", "提示");
	    			 return;
	    		}
	    		array.push(magazine);
	    		var phr=$('#phr'+j).val();
	    		if(phr==''){
	    			parent.jBox.alert("页面信息不能为空", "提示");
	  			 return;
	  			}else{
	  				 flag=r.test(phr); 
	  				 if(!flag){
	  					parent.jBox.alert("请填写正确报纸份数(非负整数)", "提示");
	  					  return;
	  				 }
	  			}
	    	}
	      if(validation(array)){
	    	  parent.jBox.alert("报纸重复", "提示");
	    	  return;
	      }
			var saveData = {
		          	beforeSend:function(){
		          		/*var loading=$('<div id="loading"></div>');
		          		$('body').append(loading);*/
		          		$("#btnSubmit").attr("disabled",true)
		          	},
					headers : {
					"token" : localStorage.getItem("token")
				},
				url : APIHost + '/magazine/save',
				success : function(response) {
					if (response.data.msg == "success") {
						parent.pageload();
						parent.hideDiv();
						parent.jBox.alert("保存成功 ", "提示");
					} else if (response.code === 1003) {
						parent.hideDiv();
						parent.jBox.alert('请先登录', '提示', {
							closed : function() {
								window.parent.location.href = APIHost
										+ "/sys/sysLogin.html";
							}
						});
					} else if (response.data.msg == "exist") {
						var list=response.data.mlist;
						var  info='<b>'+list[0].magazine+'</b>报纸今天已经添加，请添加其他报纸 '
						parent.jBox.alert(info, "提示");
					} else if (response.data.msg == "fail") {
						parent.hideDiv();
						parent.jBox.alert("异常状态 , 请联系管理员调试 !", "提示");
					}
				},
	            complete:function(){
	            	$("#btnSubmit").attr("disabled",false);
	            	$("#loading").hide();
	            }
			}
			$("#inputForm").ajaxSubmit(saveData);
		}
		// 表单输入校验
		$(document).ready(function() {
			$("#inputForm").validate({
				rules : {
					signDate : {
						required : true
					},
					phr : {
						required : true,
						number : true
					},
					magazine : {
						required : true
					},
					remarks : {
						required : false
					}
				},
				message : {
					signDate : {
						required : "请填写日期"
					},
					phr : {
						required : "请填写数字"
					},
					magazine : {
						required : "报刊名称"
					},
					remarks : {
						required : "备注",
					}
				}
			});
		});
		// 取消保存请求		
		function back() {
			parent.hideDiv();
		}

		//点击新增
		function add() {
			var i = $('#hidden0').val();
			if(i<5){
				i++;
				$('#hidden' + i).show();
				$('#hidden0').val(i);
			}
			
		}
		function reduce() {
			var i = $('#hidden0').val();
			if(i>-1){
				$('#hidden' + i).hide();
				$("#magazine"+ i).val("");
				$("#phr"+ i).val("");
				i--;
				$('#hidden0').val(i);
			}
		}
		
    	function validation(a)
    	{
    	   return /(\x0f[^\x0f]+)\x0f[\s\S]*\1/.test("\x0f"+a.join("\x0f\x0f") +"\x0f");
    	}
	</script>
</body>
</html>